[{"categories":["openwrt"],"content":"èƒŒæ™¯ åœ¨å®¶åŠå…¬éœ€è¦ä½¿ç”¨ openvpn è¿æ¥å…¬å¸å†…ç½‘ï¼Œè€Œä¸”å¯†ç ä½¿ç”¨ å›ºå®šå¯†ç  +TOTP éªŒè¯ç  çš„å½¢å¼ï¼Œæ¯æ¬¡éƒ½éœ€è¦æ‰“å¼€ç”µè„‘çš„openvpnå®¢æˆ·ç«¯ï¼Œæ‰“å¼€éªŒè¯ç å®¢æˆ·ç«¯å¤åˆ¶éªŒè¯ç ï¼Œè¿æ¥ï¼Œåªèƒ½è¯´ç¹çã€‚å¸Œæœ›é€šè¿‡å®¶é‡Œçš„è½¯è·¯ç”±openwrtçš„openvpnå®¢æˆ·ç«¯æ¥å®ç°ä¸Šè¿°æ“ä½œçš„ä¸€é”®è¿æ¥ï¼Œå®ç°å®¶é‡Œæ¯ä¸ªç»ˆç«¯è®¾å¤‡éƒ½èƒ½è¿æ¥å…¬å¸å†…ç½‘ã€‚ å®æ“ ç¡®ä¿ä½ çš„openwrtæœåŠ¡åˆ—è¡¨é‡Œå·²ç»å®‰è£…openwrtï¼Œå¦‚æ²¡æœ‰è¯·è‡ªè¡Œå®‰è£…ï¼Œåœ¨openwrtä¸‹æ–°å»º /root/openvpn ç›®å½•ï¼Œä¸€åˆ‡æ“ä½œå‡åœ¨è¿™ä¸ªç›®å½•ä¸‹è¿›è¡Œã€‚ ","date":"2023-07-20","objectID":"/posts/openwrt-openvpn/:0:0","tags":["openwrt","openvpn"],"title":"Openwrtä¸‹ä½¿ç”¨TOTPåŠ¨æ€éªŒè¯ç è¿æ¥Openvpn","uri":"/posts/openwrt-openvpn/"},{"categories":["openwrt"],"content":"ï¼ˆ1ï¼‰openwrtå®‰è£…oathtool ä¸‹è½½è¿æ¥ï¼š https://downloads.openwrt.org/releases/packages-21.02/x86_64/packages/oath-toolkit_2.6.5-1_x86_64.ipk ä¸‹è½½ä¸Šä¼ è‡³openwrtï¼Œå®‰è£… opkg install /tmp/upload/oath-toolkit_2.6.5-1_x86_64.ipk éªŒè¯ï¼š oathtool -b --totp 'ä½ çš„å¯†é’¥' å’Œè°·æ­Œèº«ä»½éªŒè¯å™¨é‡Œçš„éªŒè¯ç æ­¤æ—¶æ˜¯å¦ä¸€è‡´ã€‚ ","date":"2023-07-20","objectID":"/posts/openwrt-openvpn/:1:0","tags":["openwrt","openvpn"],"title":"Openwrtä¸‹ä½¿ç”¨TOTPåŠ¨æ€éªŒè¯ç è¿æ¥Openvpn","uri":"/posts/openwrt-openvpn/"},{"categories":["openwrt"],"content":"ï¼ˆ2ï¼‰ç”Ÿæˆè´¦æˆ·å¯†ç  åœ¨/root/openvpnä¸‹æ–°å»ºgenerate-password.sh è„šæœ¬ï¼Œå†…å®¹å¦‚ä¸‹ï¼Œ yzm=$(/usr/bin/oathtool -b --totp 'ä½ çš„å¯†é’¥') echo -e \"å…¬å¸openvpnè´¦å·\\nå…¬å¸openvpnå›ºå®šå¯†ç ${yzm}\" \u003e /root/openvpn/userpass.txt ","date":"2023-07-20","objectID":"/posts/openwrt-openvpn/:2:0","tags":["openwrt","openvpn"],"title":"Openwrtä¸‹ä½¿ç”¨TOTPåŠ¨æ€éªŒè¯ç è¿æ¥Openvpn","uri":"/posts/openwrt-openvpn/"},{"categories":["openwrt"],"content":"ï¼ˆ3ï¼‰openvpné…ç½®æ–‡ä»¶ ä¸Šä¼ xxx.crtã€xxx.keyã€xxx.ovpnç­‰æ–‡ä»¶åˆ°openwrtï¼Œå¹¶ç§»åŠ¨åˆ°/root/openvpn ç›®å½•ä¸‹ï¼Œä¿®æ”¹ovpnæ–‡ä»¶ã€‚ auth-user-passæ­¤é¡¹ä¿®æ”¹ä½ä¸º auth-user-pass userpass.txtï¼Œä»æ–‡ä»¶ä¸­è¯»å–ç”¨æˆ·åå¯†ç ã€‚ ä¸ºäº†ä½¿æŒ‡å®šçš„ipæ®µä½¿ç”¨openvpnï¼Œè€Œå…¶ä»–çš„ç½‘ç»œèµ°è·¯ç”±é»˜è®¤çº¿è·¯ï¼Œåœ¨ovpnæ–‡ä»¶ä¸‹è¿½åŠ route-nopullåŠå…¶ä¸‹é¢çš„å†…å®¹ã€‚ å…¶ä¸­ 10.87.1.0ã€10.88.1.0 ä¿®æ”¹ä¸ºéœ€è¦èµ°openvpnçš„ipæ®µï¼Œè¿™æ · 10.87.1.1~10.87.1.254 ã€10.88.1.1~10.88.1.254 å°±ä¼šèµ°openvpnï¼Œæ ¹æ®è‡ªå·±éœ€è¦ä¿®æ”¹ã€‚ client dev tun link-mtu 1500 proto tcp remote xxx.com 8888 resolv-retry infinite nobind persist-key persist-tun ca xxx.crt remote-cert-tls server tls-auth xxx.key 1 cipher AES-256-CBC auth-user-pass userpass.txt verb 3 auth-nocache reneg-sec 36000 route-nopull pull-filter ignore \"dhcp-option DNS \" route 10.87.1.0 255.255.255.0 vpn_gateway route 10.88.1.0 255.255.255.0 vpn_gateway ","date":"2023-07-20","objectID":"/posts/openwrt-openvpn/:3:0","tags":["openwrt","openvpn"],"title":"Openwrtä¸‹ä½¿ç”¨TOTPåŠ¨æ€éªŒè¯ç è¿æ¥Openvpn","uri":"/posts/openwrt-openvpn/"},{"categories":["openwrt"],"content":"ï¼ˆ4ï¼‰openwrté…ç½®ä¿®æ”¹ ä¿®æ”¹ /etc/config/openvpn ï¼Œåœ¨å…¶ä¸‹è¿½åŠ è‡ªå·±çš„openvpné…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œåå­—æ ¹æ®éœ€è¦ä¿®æ”¹ã€‚ config openvpn 'å…¬å¸vpn' option config '/root/openvpn/xxx.ovpn' ä¸ºäº†åœ¨å¯åŠ¨æ—¶å…ˆç”Ÿæˆå¯†ç æ–‡ä»¶userpass.txtï¼Œä¿®æ”¹ /etc/init.d/openvpn è„šæœ¬ï¼Œåœ¨ openvpn_add_instance() å‡½æ•°ä¸‹ç¬¬ä¸€è¡ŒåŠ ä¸Š sh /root/openvpn/generate-password.shï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ openvpn_add_instance() { sh /root/openvpn/generate-password.sh local name=\"$1\" local dir=\"$2\" local conf=\"$3\" local security=\"$4\" local up=\"$5\" local down=\"$6\" ... } æ­¤æ—¶openwrtç½‘é¡µopenvpnä¸‹å°±æœ‰äº†åˆšåˆšåŠ çš„é…ç½®äº†ï¼Œå‹¾é€‰å¯ç”¨ï¼Œç‚¹å‡»ä¿å­˜åº”ç”¨ã€‚ ","date":"2023-07-20","objectID":"/posts/openwrt-openvpn/:4:0","tags":["openwrt","openvpn"],"title":"Openwrtä¸‹ä½¿ç”¨TOTPåŠ¨æ€éªŒè¯ç è¿æ¥Openvpn","uri":"/posts/openwrt-openvpn/"},{"categories":["openwrt"],"content":"ï¼ˆ5ï¼‰ä¿®æ”¹openwrté˜²ç«å¢™ ä¸Šé¢çš„æ“ä½œå®Œæˆåï¼Œä½ ä¼šå‘ç°åœ¨openwrté‡Œèƒ½pingé€šéœ€è¦é€šè¿‡openvpnè¿æ¥çš„ipæ®µï¼Œä½†æ˜¯è¿æ¥è·¯ç”±çš„è®¾å¤‡å¹¶ä¸èƒ½è¿é€šï¼Œéœ€è¦ä¿®æ”¹é˜²ç«å¢™ï¼Œåœ¨é˜²ç«å¢™è‡ªå®šä¹‰è§„åˆ™é‡Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œå…¶ä¸­192.168.8.0/24ä¿®æ”¹ä¸ºä½ çš„è·¯ç”±ç½‘æ®µï¼Œ10.87.1.0/24,10.88.1.0/24ä¿®æ”¹ä¸ºä½ éœ€è¦é€šè¿‡openvpnè¿æ¥çš„å…¬å¸ipç½‘æ®µ10.87.1.*,10.88.1.*,å¦‚æœæƒ³è¦è¾¾åˆ°è¿æ¥ 10.87.*.*çš„æ•ˆæœï¼Œå¯ä»¥æ”¹æˆ 10.87.0.0/16 ï¼Œè¿™æ–¹é¢çš„ç½‘ç»œçŸ¥è¯†ï¼Œè¯·è‡ªè¡ŒæŸ¥é˜…ç›¸å…³èµ„æ–™ã€‚ æ³¨ï¼šæˆ‘ä½¿ç”¨äº†openwrtçš„mosdnsåŠŸèƒ½ï¼Œå…¬å¸çš„å†…ç½‘åŸŸåæ”¾åˆ°äº†mosdnsè‡ªå®šä¹‰hostsé‡Œäº†ã€‚æ²¡ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½å¯ä»¥é€šè¿‡ç½‘ç»œ-DHCP/DNSé‡Œé¢å¤–çš„HOSTSæ–‡ä»¶æ¥å®ç°è‡ªå®šä¹‰åŸŸåã€‚ iptables -I FORWARD -o tun0 -j ACCEPT iptables -t nat -I POSTROUTING -s 192.168.8.0/24 -d 10.87.1.0/24,10.88.1.0/24 -o tun0 -j MASQUERADE å‚è€ƒ openwrtä¸‹çš„openvpn clientå®ç° - PHPERZä¸­æ–‡èµ„è®¯ç«™ Soul Of Free Loop Â» åšå®¢å­˜æ¡£ Â» OpenWRTå®ç°OpenVPNæŒ‰ipsetè‡ªåŠ¨åˆ†æµ (zohead.com) ","date":"2023-07-20","objectID":"/posts/openwrt-openvpn/:5:0","tags":["openwrt","openvpn"],"title":"Openwrtä¸‹ä½¿ç”¨TOTPåŠ¨æ€éªŒè¯ç è¿æ¥Openvpn","uri":"/posts/openwrt-openvpn/"},{"categories":["php"],"content":"ä¸€äº›m3uæˆ–è€…m3u8æ ¼å¼çš„ç›´æ’­åœ°å€æ–‡ä»¶åœ¨ä¸€äº›è½¯ä»¶ä¸­å¹¶ä¸æ”¯æŒï¼Œåœ¨chatgptçš„å¸®åŠ©ä¸‹ï¼Œä½¿ç”¨phpå®ç°äº†åœ¨çº¿è½¬æ¢æˆtxtæ ¼å¼ï¼Œéœ€è¦èƒ½è¿è¡Œphpçš„æœåŠ¡å™¨ã€‚ ä»£ç å¦‚ä¸‹ï¼Œå‘½åä¸º m3u-txt.php ï¼Œå°†å…¶æ”¾åœ¨èƒ½è¿è¡Œphpçš„æœåŠ¡å™¨ä¸Šï¼Œè®¿é—® http://xxxxxx.com/m3u-txt.php?url=https://raw.githubusercontent.com/fanmingming/live/main/tv/m3u/ipv6.m3u å¯ç›´æ¥è½¬æ¢ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯å¯èƒ½ä¸€äº›m3uæ–‡ä»¶æ ¼å¼ä¸å®Œå…¨ä¸€æ ·å¯¼è‡´è½¬æ¢ä¸æˆåŠŸï¼Œè¯·å‚è€ƒpreg_match_all('/#EXTINF:-1.*?group-title=\"(.*?)\".*?,(.*?)\\n(.*?)\\n/s', $file, $matches, PREG_SET_ORDER)ä¿®æ”¹ã€‚ \u003c?php $file = file_get_contents($_GET['url']); // ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–group_titleå’Œm3u8é“¾æ¥ preg_match_all('/#EXTINF:-1.*?group-title=\"(.*?)\".*?,(.*?)\\n(.*?)\\n/s', $file, $matches, PREG_SET_ORDER); $result = array(); foreach ($matches as $match) { $group_title = $match[1]; $url = $match[3]; $channel_name = $match[2]; $result[$group_title][] = $channel_name . ',' . $url; } $line_f = \"\\n\"; // è¾“å‡ºå¤„ç†åçš„ç»“æœ if (isset($_SERVER[\"HTTP_USER_AGENT\"]) \u0026\u0026 strpos($_SERVER[\"HTTP_USER_AGENT\"], \"Mozilla\") !== false) { // å¦‚æœæ˜¯æµè§ˆå™¨è®¿é—®ï¼Œå°† \"\\n\" æ›¿æ¢ä¸º \"\u003cbr\u003e\" è¾“å‡º $line_f = \"\u003cbr\u003e\"; } // è¾“å‡ºç»“æœ foreach ($result as $group_title =\u003e $channels) { echo $group_title . ',#genre#' . $line_f; foreach ($channels as $channel) { echo $channel . $line_f; } echo $line_f; } ?\u003e æ•ˆæœå¦‚ä¸‹ã€‚ https://raw.githubusercontent.com/fanmingming/live/main/tv/m3u/ipv6.m3u åŸæ ¼å¼ï¼š è½¬æ¢åæ ¼å¼ï¼š ","date":"2023-05-29","objectID":"/posts/m3u8-convert-to-txt/:0:0","tags":["php","m3u"],"title":"m3u8æ ¼å¼ç›´æ’­åœ°å€æ–‡ä»¶ä½¿ç”¨phpåœ¨çº¿è½¬æ¢æˆtxtæ ¼å¼","uri":"/posts/m3u8-convert-to-txt/"},{"categories":["cloudflare"],"content":"Cloudflareä¼˜é€‰ipå¹¶ä½¿ç”¨dnspodcn apiè®¾ç½®è§£æï¼Œå®ç°åœ¨æœ¬åœ°ç½‘ç»œç¯å¢ƒä¸‹nasæˆ–è€…å…¶ä»–æœåŠ¡å™¨ä¸Šä¼˜é€‰IPï¼Œå¹¶è‡ªåŠ¨è§£æåˆ°è‡ªå·±çš„dnspodcnåŸŸåï¼Œå®ç°é€Ÿåº¦æœ€ä¼˜ã€‚ ","date":"2023-05-29","objectID":"/posts/cloudflare-betterip-dnspodcn/:0:0","tags":["cloudflare"],"title":"Cloudflareä¼˜é€‰ipå¹¶ä½¿ç”¨dnspodcn apiè®¾ç½®è§£æ","uri":"/posts/cloudflare-betterip-dnspodcn/"},{"categories":["cloudflare"],"content":"ä¼˜é€‰ip è¯·å‚è€ƒgithubé¡¹ç›® XIU2/CloudflareSpeedTest: ğŸŒ©ã€Œè‡ªé€‰ä¼˜é€‰ IPã€æµ‹è¯• Cloudflare CDN å»¶è¿Ÿå’Œé€Ÿåº¦ï¼Œè·å–æœ€å¿« IP (IPv4 / IPv6)ï¼å¦å¤–ä¹Ÿæ”¯æŒå…¶ä»– CDN / ç½‘ç«™ IP ~ (github.com) æˆ‘çš„æœ¬åœ°æœåŠ¡å™¨ä¸ºcentos8ç³»ç»Ÿï¼Œä¸‹è½½å¹¶è§£å‹åˆ° /opt/cloudflareST ç›®å½•ã€‚ ","date":"2023-05-29","objectID":"/posts/cloudflare-betterip-dnspodcn/:1:0","tags":["cloudflare"],"title":"Cloudflareä¼˜é€‰ipå¹¶ä½¿ç”¨dnspodcn apiè®¾ç½®è§£æ","uri":"/posts/cloudflare-betterip-dnspodcn/"},{"categories":["cloudflare"],"content":"dnspodcn api è®¾ç½®è§£æ å‚è€ƒrehiy/dnspod-shell: åŸºäºDNSPodç”¨æˆ·APIå®ç°çš„çº¯ShellåŠ¨æ€åŸŸåå®¢æˆ·ç«¯ (github.com) ï¼ŒåŠ å…¥çº¿è·¯é€»è¾‘ä¿®æ”¹è€Œæ¥ã€‚ è¿›å…¥ /opt/cloudflareST ç›®å½•ï¼Œæ–°å»ºä»¥ä¸‹è„šæœ¬ã€‚éœ€è¦ä¿®æ”¹ï¼š ä¿®æ”¹arToken=â€œ12345,xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxâ€ ä¸ºä½ è‡ªå·±çš„dnspodcnçš„token ä¿®æ”¹arDdnsCheck â€œxx.yyâ€ â€œsub1â€ ä¸ºä½ è‡ªå·±çš„åŸŸåã€‚ hostIp=$(awk -F ',' 'NR==2 {print $1}' /opt/cloudflareST/result.csv) æ³¨æ„æ­¤å¤„ä¼˜é€‰ipç»“æœæ–‡ä»¶ä½ç½®ï¼Œç»“åˆä½ çš„è¿è¡Œç›®å½•ä¿®æ”¹ã€‚ #!/bin/sh # ################################################################### # AnripDdns v6.4.0 # # Dynamic DNS using DNSPod API # # Author: Rehiy, https://github.com/rehiy # https://www.rehiy.com/?s=dnspod # # Collaborators: https://github.com/rehiy/dnspod-shell/graphs/contributors # # Usage: please refer to `ddnspod.sh` # ################################################################### params ## export arToken # The url to be used for querying public ip address. export arIp4QueryUrl=\"http://ipv4.rehi.org/ip\" export arIp6QueryUrl=\"http://ipv6.rehi.org/ip\" # The temp file to store the last record ip # The error code to return when a ddns record is not changed # By default, report unchanged event as success export arErrCodeUnchanged=0 ################################################################### logger ## # Output log to stderr arLog() { \u003e\u00262 echo \"$@\" } ################################################################### http client ## # Use curl or wget open url # Args: url postdata arRequest() { local url=\"$1\" local data=\"$2\" local params=\"\" local agent=\"AnripDdns/6.4.0(wang@rehiy.com)\" if type curl \u003e/dev/null 2\u003e\u00261; then if echo $url | grep -q https; then params=\"$params -k\" fi if [ -n \"$data\" ]; then params=\"$params -d $data\" fi curl -s -A \"$agent\" $params $url return $? fi if type wget \u003e/dev/null 2\u003e\u00261; then if echo $url | grep -q https; then params=\"$params --no-check-certificate\" fi if [ -n \"$data\" ]; then params=\"$params --post-data $data\" fi wget -qO- -U \"$agent\" $params $url return $? fi return 1 } # Get IPv4 by ip route or network arWanIp4() { local hostIp hostIp=$(awk -F ',' 'NR==2 {print $1}' /opt/cloudflareST/result.csv) echo $hostIp } ################################################################### dnspod api ## # Dnspod Bridge # Args: interface data arDdnsApi() { local dnsapi=\"https://dnsapi.cn/${1:?'Info.Version'}\" local params=\"login_token=$arToken\u0026format=json\u0026lang=en\u0026$2\" arRequest \"$dnsapi\" \"$params\" } # Fetch Record Id # Args: domain subdomain recordType arDdnsLookup() { local errMsg # Get Record Id recordId=$(arDdnsApi \"Record.List\" \"domain=$1\u0026sub_domain=$2\u0026record_type=$3\u0026record_line=$4\") recordId=$(echo $recordId | sed 's/.*\"id\":\"\\([0-9]*\\)\".*/\\1/') if ! [ \"$recordId\" -gt 0 ] 2\u003e/dev/null ;then errMsg=$(echo $recordId | sed 's/.*\"message\":\"\\([^\\\"]*\\)\".*/\\1/') arLog \"\u003e arDdnsLookup - $errMsg\" return 1 fi echo $recordId } # Update Record Value # Args: domain subdomain recordId recordType [hostIp] arDdnsUpdate() { local errMsg local recordRs local recordCd local recordIp local lastRecordIp yys_line=$6 arLastRecordFile=/run/ardnspod_last_record_\"$2\".\"$1\".\"$yys_line\" if [ -f $arLastRecordFile ]; then lastRecordIp=$(cat $arLastRecordFile) fi # fetch the last record ip from api if [ -z \"$lastRecordIp\" ]; then recordRs=$(arDdnsApi \"Record.Info\" \"domain=$1\u0026record_id=$3\") recordCd=$(echo $recordRs | sed 's/.*{\"code\":\"\\([0-9]*\\)\".*/\\1/') lastRecordIp=$(echo $recordRs | sed 's/.*,\"value\":\"\\([0-9a-fA-F\\.\\:]*\\)\".*/\\1/') fi if [ \"$5\" = \"$lastRecordIp\" ]; then arLog \"\u003e arDdnsUpdate - unchanged: $recordIp\" # unchanged event return $arErrCodeUnchanged fi recordRs=$(arDdnsApi \"Record.Ddns\" \"domain=$1\u0026sub_domain=$2\u0026record_id=$3\u0026record_type=$4\u0026value=$5\u0026record_line=$yys_line\") # parse result recordCd=$(echo $recordRs | sed 's/.*{\"code\":\"\\([0-9]*\\)\".*/\\1/') recordIp=$(echo $recordRs | sed 's/.*,\"value\":\"\\([0-9a-fA-F\\.\\:]*\\)\".*/\\1/') if [ \"$recordCd\" != \"1\" ]; then errMsg=$(echo $recordRs | sed 's/.*,\"message\":\"\\([^\"]*\\)\".*/\\1/') arLog \"\u003e arDdnsUpdate - error: $errMsg\" return 1 elif [ \"$recordIp\" = \"$lastRecordIp\" ]; then arLog \"\u003e arDdnsUpdate - unchanged: $recordIp\" # unchanged even","date":"2023-05-29","objectID":"/posts/cloudflare-betterip-dnspodcn/:2:0","tags":["cloudflare"],"title":"Cloudflareä¼˜é€‰ipå¹¶ä½¿ç”¨dnspodcn apiè®¾ç½®è§£æ","uri":"/posts/cloudflare-betterip-dnspodcn/"},{"categories":["cloudflare"],"content":"å®šæ—¶è¿è¡Œ æˆ‘ä½¿ç”¨crontabï¼Œ8å°æ—¶è¿è¡Œä¸€æ¬¡ï¼Œè¯·æ ¹æ®éœ€è¦è‡ªè¡Œä¿®æ”¹ã€‚ 0 */8 * * * /opt/cloudflareST/dnspodcn.sh \u003e\u003e /opt/cloudflareST/log.txt ","date":"2023-05-29","objectID":"/posts/cloudflare-betterip-dnspodcn/:3:0","tags":["cloudflare"],"title":"Cloudflareä¼˜é€‰ipå¹¶ä½¿ç”¨dnspodcn apiè®¾ç½®è§£æ","uri":"/posts/cloudflare-betterip-dnspodcn/"},{"categories":["ç¼–ç¨‹"],"content":"å®ç° spark dataframe/dataset æ ¹æ®mysqlè¡¨å”¯ä¸€é”®å®ç°æœ‰åˆ™æ›´æ–°ï¼Œæ— åˆ™æ’å…¥åŠŸèƒ½ã€‚ åŸºäº spark2.4.3 scala2.11.8 ","date":"2023-04-18","objectID":"/posts/spark-mysql-upsert/:0:0","tags":["spark","å¤§æ•°æ®"],"title":"spark å®ç° mysql upsert","uri":"/posts/spark-mysql-upsert/"},{"categories":["ç¼–ç¨‹"],"content":"å·¥å…·ç±» DataFrameWriterEnhance package com.xxx.utils import org.apache.spark.sql.catalyst.plans.logical.LogicalPlan import org.apache.spark.sql.execution.SQLExecution import org.apache.spark.sql.execution.datasources.DataSource import org.apache.spark.sql.execution.datasources.jdbc.{JDBCOptions, JdbcOptionsInWrite, JdbcRelationProvider, JdbcUtils} import org.apache.spark.sql.jdbc.{JdbcDialect, JdbcDialects} import org.apache.spark.sql.sources.BaseRelation import org.apache.spark.sql.types.StructType import org.apache.spark.sql._ import java.sql.Connection object DataFrameWriterEnhance { implicit class DataFrameWriterMysqlUpdateEnhance(writer: DataFrameWriter[Row]) { def update(): Unit = { val extraOptionsField = writer.getClass.getDeclaredField(\"org$apache$spark$sql$DataFrameWriter$$extraOptions\") val dfField = writer.getClass.getDeclaredField(\"df\") val sourceField = writer.getClass.getDeclaredField(\"source\") val partitioningColumnsField = writer.getClass.getDeclaredField(\"partitioningColumns\") extraOptionsField.setAccessible(true) dfField.setAccessible(true) sourceField.setAccessible(true) partitioningColumnsField.setAccessible(true) val extraOptions = extraOptionsField.get(writer).asInstanceOf[scala.collection.Map[String, String]] val df = dfField.get(writer).asInstanceOf[DataFrame] val partitioningColumns = partitioningColumnsField.get(writer).asInstanceOf[Option[Seq[String]]] val logicalPlanField = df.getClass.getDeclaredField(\"logicalPlan\") logicalPlanField.setAccessible(true) var logicalPlan = logicalPlanField.get(df).asInstanceOf[LogicalPlan] val session = df.sparkSession val dataSource = DataSource( sparkSession = session, className = s\"${DataFrameWriterEnhance.getClass.getName}MysqlUpdateRelationProvider\", partitionColumns = partitioningColumns.getOrElse(Nil), options = extraOptions.toMap) logicalPlan = dataSource.planForWriting(SaveMode.Append, logicalPlan) val qe = session.sessionState.executePlan(logicalPlan) SQLExecution.withNewExecutionId(session, qe)(qe.toRdd) } } class MysqlUpdateRelationProvider extends JdbcRelationProvider { override def createRelation(sqlContext: SQLContext, mode: SaveMode, parameters: Map[String, String], df: DataFrame): BaseRelation = { val options = new JdbcOptionsInWrite(parameters) val isCaseSensitive = sqlContext.sparkSession.sessionState.conf.caseSensitiveAnalysis val conn = JdbcUtils.createConnectionFactory(options)() try { val tableExists = JdbcUtils.tableExists(conn, options) if (tableExists) { mode match { case SaveMode.Overwrite =\u003e if (options.isTruncate \u0026\u0026 JdbcUtils.isCascadingTruncateTable(options.url).contains(false)) { // In this case, we should truncate table and then load. JdbcUtils.truncateTable(conn, options) val tableSchema = JdbcUtils.getSchemaOption(conn, options) updateTable(df, tableSchema, isCaseSensitive, options) } else { // Otherwise, do not truncate the table, instead drop and recreate it JdbcUtils.dropTable(conn, options.table, options) JdbcUtils.createTable(conn, df, options) updateTable(df, Some(df.schema), isCaseSensitive, options) } case SaveMode.Append =\u003e val tableSchema = JdbcUtils.getSchemaOption(conn, options) updateTable(df, tableSchema, isCaseSensitive, options) case SaveMode.ErrorIfExists =\u003e throw new Exception( s\"Table or view '${options.table}' already exists. \" + s\"SaveMode: ErrorIfExists.\") case SaveMode.Ignore =\u003e // With `SaveMode.Ignore` mode, if table already exists, the save operation is expected // to not save the contents of the DataFrame and to not change the existing data. // Therefore, it is okay to do nothing here and then just return the relation below. } } else { JdbcUtils.createTable(conn, df, options) updateTable(df, Some(df.schema), isCaseSensitive, options) } } finally { conn.close() } createRelation(sqlContext, parameters) } def updateTable(df: DataFrame, tableSchema: Option[StructType], isCaseSensitive: Boolean, options: JdbcOptionsInWrite): Unit = { val url = options.url val table = options.table val dialect = JdbcDialects.get(url)","date":"2023-04-18","objectID":"/posts/spark-mysql-upsert/:1:0","tags":["spark","å¤§æ•°æ®"],"title":"spark å®ç° mysql upsert","uri":"/posts/spark-mysql-upsert/"},{"categories":["ç¼–ç¨‹"],"content":"å·¥å…·ç±» MysqlUtils package com.xxx.utils import com.xxx.utils.DataFrameWriterEnhance.DataFrameWriterMysqlUpdateEnhance import org.apache.spark.sql.functions.col import org.apache.spark.sql.types.{NullType, ShortType} import org.apache.spark.sql.{DataFrame, SaveMode, SparkSession} object MysqlUtils { def upsert(rawDF: DataFrame, database: String, tableName: String)(implicit spark: SparkSession): Unit = { var df = rawDF for (elem \u003c- df.schema.fields) { if (elem.dataType == NullType) { df = df.withColumn(elem.name, col(elem.name).cast(ShortType)) } } df.write .format(\"jdbc\") .mode(SaveMode.Append) .option(\"driver\", \"com.mysql.jdbc.Driver\") .option(\"url\", spark.conf.get(s\"spark.job.mysql.${database}.url\")) .option(\"user\", spark.conf.get(s\"spark.job.mysql.${database}.username\")) .option(\"password\", spark.conf.get(s\"spark.job.mysql.${database}.password\")) .option(\"dbtable\", tableName) .option(\"useSSL\", \"false\") .option(\"showSql\", \"false\") .option(\"numPartitions\", \"1\") .update() } } ","date":"2023-04-18","objectID":"/posts/spark-mysql-upsert/:2:0","tags":["spark","å¤§æ•°æ®"],"title":"spark å®ç° mysql upsert","uri":"/posts/spark-mysql-upsert/"},{"categories":["ç¼–ç¨‹"],"content":"ä½¿ç”¨ sparkå¯åŠ¨è„šæœ¬åŠ å…¥mysqlé…ç½® spark-submit \\ --master yarn \\ --deploy-mode cluster \\ --executor-memory 3G \\ --num-executors 5 \\ --executor-cores 4 \\ --driver-memory 3G \\ --conf spark.job.mysql.test.url=${jdbc_url} \\ --conf spark.job.mysql.test.username=${jdbc_username} \\ --conf spark.job.mysql.test.password=${jdbc_password} \\ ä½¿ç”¨èŒƒä¾‹ import utils.MysqlUtils object TestMysqlUpsert { def main(args: Array[String]): Unit = { implicit val spark = SparkSession.builder().enableHiveSupport().getOrCreate() import spark.implicits._ val database = \"test\" val arr = Array((1,11,\"name1\",11111),(2,22,\"name2\",22222)) val df = spark.sparkContext.parallelize(arr) .toDF(\"key_one\", \"key_two\", \"val_one\", \"val_two\") MysqlUtils.upsert(df, database, \"test_unique_key\") spark.close() } } test_unique_keyè¡¨ç»“æ„ CREATE TABLE `test_unique_key` ( `key_one` int(11) NOT NULL DEFAULT '0', `key_two` int(11) NOT NULL DEFAULT '0', `val_one` varchar(50) DEFAULT NULL, `val_two` int(11) NOT NULL DEFAULT '0', UNIQUE KEY `uk` (`key_one`,`key_two`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='test'; ","date":"2023-04-18","objectID":"/posts/spark-mysql-upsert/:3:0","tags":["spark","å¤§æ•°æ®"],"title":"spark å®ç° mysql upsert","uri":"/posts/spark-mysql-upsert/"},{"categories":["ç¼–ç¨‹"],"content":"å‚è€ƒ csdn_Spark Upsertå†™å…¥Mysql(scalaå¢å¼º) æ— éœ€ä¾èµ– ","date":"2023-04-18","objectID":"/posts/spark-mysql-upsert/:4:0","tags":["spark","å¤§æ•°æ®"],"title":"spark å®ç° mysql upsert","uri":"/posts/spark-mysql-upsert/"},{"categories":["ç¼–ç¨‹"],"content":"è®¿é—®æŸæ¥å£æ‹‰å–æ•°æ®ï¼Œæ¥å£éœ€è¦é¢‘æ¬¡æ§åˆ¶ï¼Œç»è°ƒç ”ï¼Œcom.google.common.util.concurrent.RateLimiterå¯è½»æ˜“å®ç°ã€‚ ","date":"2023-04-18","objectID":"/posts/java-rate-limit-google-guava/:0:0","tags":["java"],"title":"java é¢‘æ¬¡æ§åˆ¶","uri":"/posts/java-rate-limit-google-guava/"},{"categories":["ç¼–ç¨‹"],"content":"1. Maven \u003cdependency\u003e \u003cgroupId\u003ecom.google.guava\u003c/groupId\u003e \u003cartifactId\u003eguava\u003c/artifactId\u003e \u003cversion\u003e31.1-jre\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003ecn.hutool\u003c/groupId\u003e \u003cartifactId\u003ehutool-all\u003c/artifactId\u003e \u003cversion\u003e5.8.4\u003c/version\u003e \u003c/dependency\u003e ","date":"2023-04-18","objectID":"/posts/java-rate-limit-google-guava/:1:0","tags":["java"],"title":"java é¢‘æ¬¡æ§åˆ¶","uri":"/posts/java-rate-limit-google-guava/"},{"categories":["ç¼–ç¨‹"],"content":"2. æµ‹è¯•ä»£ç  import cn.hutool.http.HttpRequest; import com.google.common.util.concurrent.RateLimiter; import java.util.List; import java.util.Map; import java.util.concurrent.TimeUnit; public class RateLimiterTest { private final RateLimiter rateLimiter = RateLimiter.create(20,1000, TimeUnit.MILLISECONDS); private RateLimiterTest() { } private static final class InstanceHolder { static final RateLimiterTest instance = new RateLimiterTest(); } public static RateLimiterTest getInstance() { return InstanceHolder.instance; } public String runHttpGet(String url, Map\u003cString, List\u003cString\u003e\u003e header) { rateLimiter.acquire(1); return HttpRequest .get(url) .header(header) .execute() .body(); } } import java.util.*; import java.util.concurrent.*; public class TestRate { public static void main(String[] args) throws InterruptedException, ExecutionException { String url = \"https://xxxxx\"; Map\u003cString, List\u003cString\u003e\u003e header = new HashMap\u003c\u003e(); header.put(\"Content-type\", Collections.singletonList(\"application/json\")); header.put(\"Access-Token\", Collections.singletonList(\"xxxxx\")); List\u003cCallable\u003cString\u003e\u003e tasks = new ArrayList\u003c\u003e(); for (int i = 0; i \u003c 60; i++) { Callable\u003cString\u003e callable = () -\u003e { RateLimiterTest instance = RateLimiterTest.getInstance(); return instance.runHttpGet(url, header); }; tasks.add(callable); } ExecutorService exec = Executors.newFixedThreadPool(60); List\u003cFuture\u003cString\u003e\u003e futures = exec.invokeAll(tasks); for (Future\u003cString\u003e future : futures) { String s = future.get(); System.out.println(s); } exec.shutdown(); } } ","date":"2023-04-18","objectID":"/posts/java-rate-limit-google-guava/:2:0","tags":["java"],"title":"java é¢‘æ¬¡æ§åˆ¶","uri":"/posts/java-rate-limit-google-guava/"},{"categories":["ç¼–ç¨‹"],"content":" import easyocr import torch gpu_is_available = torch.cuda.is_available() reader = easyocr.Reader(['ch_sim', 'en'], gpu=gpu_is_available) ocr_data = reader.readtext('/image/path', detail=0, text_threshold=0.7, low_text=0.1, width_ths=0.3) detail = 0 ä»…è¾“å‡ºè¯†åˆ«åˆ°çš„æ–‡å­— text_threshold=0.7 æ–‡æœ¬ç½®ä¿¡é˜ˆå€¼ï¼Œå€¼è¶Šå°ï¼Œæ–‡æœ¬å—å†…è¢«è¯†åˆ«ä¸ºæ–‡å­—çš„å¯èƒ½æ€§è¶Šé«˜ low_text=0.1 å€¼è¶Šå°ï¼Œå›¾ç‰‡å†…å®¹è¢«è¯†åˆ«ä¸ºæ–‡æœ¬å—çš„å¯èƒ½æ€§å°±æ›´é«˜ width_ths=0.3 æ§åˆ¶æ¨ªå‘å›¾ç‰‡å†…å®¹æ˜¯å¦ä¼šè¢«è¯†åˆ«ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªæ–‡æœ¬å—ï¼Œå€¼è¶Šå°è¢«è¯†åˆ«æˆå¤šä¸ªæ–‡æœ¬å—çš„å¯èƒ½æ€§å°±æ›´é«˜ å¾…ç»­â€¦ å‚è€ƒï¼š å®˜æ–¹æ–‡æ¡£ Pythonä½¿ç”¨EasyOCRåº“å¯¹è¡Œç¨‹ç å›¾ç‰‡è¿›è¡ŒOCRæ–‡å­—è¯†åˆ«ä»‹ç»ä¸å®è·µ ","date":"2023-04-18","objectID":"/posts/python3-easyocr-simple/:0:0","tags":["python"],"title":"python3 easyocr ç®€å•ä½¿ç”¨è¯†åˆ«å‚æ•°","uri":"/posts/python3-easyocr-simple/"},{"categories":["ç¼–ç¨‹"],"content":"prestoè‡ªå¸¦unbase64å‡½æ•°æŸäº›æ—¶å€™ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥æƒ³è¦è‡ªå®šä¹‰ä¸€ä¸ªunbase64å‡½æ•°ã€‚ prestoè‡ªå¸¦unbase64å‡½æ•°ï¼Œç”¨æ³•å¦‚ä¸‹ã€‚ FROM_UTF8(from_base64(nickname)) ä½†æ˜¯æœ‰äº›å­—ç¬¦ä¼šæŠ¥é”™ã€‚ Query failed (#20220720_091551_00087_mkhun): Illegal base64 character -1a ","date":"2023-04-18","objectID":"/posts/presto-udf-simple/:0:0","tags":["java","å¤§æ•°æ®"],"title":"presto è‡ªå®šä¹‰å‡½æ•°ç®€è¿°","uri":"/posts/presto-udf-simple/"},{"categories":["ç¼–ç¨‹"],"content":"ideaæ–°å»ºmavené¡¹ç›® pomæ–‡ä»¶å¦‚ä¸‹ï¼š \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003ecom.facebook.presto\u003c/groupId\u003e \u003cartifactId\u003epresto-spi\u003c/artifactId\u003e \u003cversion\u003e0.272\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003ecom.google.guava\u003c/groupId\u003e \u003cartifactId\u003eguava\u003c/artifactId\u003e \u003cversion\u003e18.0\u003c/version\u003e \u003c/dependency\u003e \u003c/dependencies\u003e \u003cbuild\u003e \u003cplugins\u003e \u003cplugin\u003e \u003cgroupId\u003eorg.apache.maven.plugins\u003c/groupId\u003e \u003cartifactId\u003emaven-jar-plugin\u003c/artifactId\u003e \u003cconfiguration\u003e \u003cclassesDirectory\u003etarget/classes/\u003c/classesDirectory\u003e \u003carchive\u003e \u003cmanifest\u003e \u003cmainClass\u003ecom.alibaba.dubbo.container.Main\u003c/mainClass\u003e \u003c!-- æ‰“åŒ…æ—¶ MANIFEST.MFæ–‡ä»¶ä¸è®°å½•çš„æ—¶é—´æˆ³ç‰ˆæœ¬ --\u003e \u003cuseUniqueVersions\u003efalse\u003c/useUniqueVersions\u003e \u003caddClasspath\u003etrue\u003c/addClasspath\u003e \u003cclasspathPrefix\u003elib/\u003c/classpathPrefix\u003e \u003c/manifest\u003e \u003cmanifestEntries\u003e \u003cClass-Path\u003e.\u003c/Class-Path\u003e \u003c/manifestEntries\u003e \u003c/archive\u003e \u003c/configuration\u003e \u003c/plugin\u003e \u003cplugin\u003e \u003cgroupId\u003eorg.apache.maven.plugins\u003c/groupId\u003e \u003cartifactId\u003emaven-dependency-plugin\u003c/artifactId\u003e \u003cexecutions\u003e \u003cexecution\u003e \u003cid\u003ecopy-dependencies\u003c/id\u003e \u003cphase\u003epackage\u003c/phase\u003e \u003cgoals\u003e \u003cgoal\u003ecopy-dependencies\u003c/goal\u003e \u003c/goals\u003e \u003cconfiguration\u003e \u003ctype\u003ejar\u003c/type\u003e \u003cincludeTypes\u003ejar\u003c/includeTypes\u003e \u003coutputDirectory\u003e ${project.build.directory}/lib \u003c/outputDirectory\u003e \u003c/configuration\u003e \u003c/execution\u003e \u003c/executions\u003e \u003c/plugin\u003e \u003cplugin\u003e \u003cgroupId\u003ecom.facebook.presto\u003c/groupId\u003e \u003cartifactId\u003epresto-maven-plugin\u003c/artifactId\u003e \u003cversion\u003e0.3\u003c/version\u003e \u003cextensions\u003etrue\u003c/extensions\u003e \u003c/plugin\u003e \u003c/plugins\u003e \u003c/build\u003e ","date":"2023-04-18","objectID":"/posts/presto-udf-simple/:1:0","tags":["java","å¤§æ•°æ®"],"title":"presto è‡ªå®šä¹‰å‡½æ•°ç®€è¿°","uri":"/posts/presto-udf-simple/"},{"categories":["ç¼–ç¨‹"],"content":"functionå¼€å‘ package base64; import com.facebook.presto.common.type.StandardTypes; import com.facebook.presto.spi.function.Description; import com.facebook.presto.spi.function.ScalarFunction; import com.facebook.presto.spi.function.SqlType; import io.airlift.slice.Slice; import io.airlift.slice.Slices; public class UnBase64Function { @ScalarFunction(\"unBase64\") // å›ºå®šå‚æ•°ï¼Œè¡¨ç¤ºå‡½æ•°åçš„æ„æ€ï¼Œä¹Ÿå°±æˆ‘ä»¬åœ¨ä½¿ç”¨Prestoçš„æ—¶å€™ç”¨çš„å‡½æ•°å @Description(\"base64è§£å¯†\") // å‡½æ•°çš„æ³¨é‡Š @SqlType(StandardTypes.VARCHAR) // è¡¨ç¤ºæ•°æ®ç±»å‹ public static Slice unBase64(@SqlType(StandardTypes.VARCHAR) Slice input) { // è§£ç  String res = \"\"; try { byte[] decodeBytes = java.util.Base64.getDecoder().decode(input.toStringUtf8()); res = new String(decodeBytes, \"utf-8\"); } catch (Exception e) { } return Slices.utf8Slice(res); } } ","date":"2023-04-18","objectID":"/posts/presto-udf-simple/:2:0","tags":["java","å¤§æ•°æ®"],"title":"presto è‡ªå®šä¹‰å‡½æ•°ç®€è¿°","uri":"/posts/presto-udf-simple/"},{"categories":["ç¼–ç¨‹"],"content":"pluginå¼€å‘ import java.util.Set; import base64.Base64Function; import base64.UnBase64Function; import com.facebook.presto.spi.Plugin; import com.google.common.collect.ImmutableSet; public class PrestoUdfPlugin implements Plugin { @Override public Set\u003cClass\u003c?\u003e\u003e getFunctions() { return ImmutableSet.\u003cClass\u003c?\u003e\u003ebuilder() // æ·»åŠ æ’ä»¶class .add(UnBase64Function.class) .build(); } } ","date":"2023-04-18","objectID":"/posts/presto-udf-simple/:3:0","tags":["java","å¤§æ•°æ®"],"title":"presto è‡ªå®šä¹‰å‡½æ•°ç®€è¿°","uri":"/posts/presto-udf-simple/"},{"categories":["ç¼–ç¨‹"],"content":"åŠ è½½plugin åœ¨src/main/resourcesä¸‹åˆ›å»ºç›®å½•META-INFï¼Œå†åœ¨META-INFç›®å½•ä¸‹åˆ›å»ºservicesç›®å½•ï¼Œæ³¨æ„ä¸‹å›¾é¡¹ç›®ç»“æ„ä¸­META-INFæ˜¯çˆ¶ç›®å½• servicesæ˜¯å­ç›®å½•ï¼Œåªæ˜¯ideaåˆå¹¶æ˜¾ç¤ºäº†ï¼Œä¸æ˜¯è¯´æ–‡ä»¶å¤¹åé‡Œé¢æœ‰ç‚¹ â€œ.â€ ã€‚ç„¶ååˆ›å»ºæ–‡ä»¶com.facebook.presto.spi.Pluginï¼Œæ–‡ä»¶å†…å®¹ä¸ºpluginçš„å…¨ç±»åã€‚ ä¾‹å¦‚æœ¬ä¾‹ï¼šPrestoUdfPlugin ","date":"2023-04-18","objectID":"/posts/presto-udf-simple/:4:0","tags":["java","å¤§æ•°æ®"],"title":"presto è‡ªå®šä¹‰å‡½æ•°ç®€è¿°","uri":"/posts/presto-udf-simple/"},{"categories":["ç¼–ç¨‹"],"content":"ä¸Šçº¿ mavenæ‰“åŒ…ã€‚ åœ¨æ‰€æœ‰prestoèŠ‚ç‚¹æœåŠ¡å™¨çš„prestoå®‰è£…ç›®å½•${PRESTO_HOME}/pluginä¸‹æ–°å»ºä¸€ä¸ªmy_pluginç›®å½•ã€‚ ä¸Šä¼ jaråŒ…ï¼ŒåŠç›¸å…³ä¾èµ–åŒ…ï¼ˆåœ¨libç›®å½•ä¸‹ï¼‰åˆ°æ‰€æœ‰æœåŠ¡å™¨æ–°å»ºçš„my_pluginç›®å½•ä¸‹ã€‚ é‡å¯prestoï¼š ${PRESTO_HOME}/bin/launcher restartã€‚ é¡¹ç›®ç»“æ„ ç»“æ„ å‚è€ƒï¼šã€prestoã€‘æ–¹æ³•äºŒï¼šprestoå®ç°è‡ªå®šä¹‰UDFå‡½æ•° ","date":"2023-04-18","objectID":"/posts/presto-udf-simple/:5:0","tags":["java","å¤§æ•°æ®"],"title":"presto è‡ªå®šä¹‰å‡½æ•°ç®€è¿°","uri":"/posts/presto-udf-simple/"},{"categories":["ç¼–ç¨‹"],"content":" from urllib import parse import pandas as pd from sqlalchemy import create_engine db_info = {'user': 'test', 'password': parse.quote_plus('test'), 'host': 'xxxxxx.mysql.rds.aliyuncs.com', 'port': 3306, 'database': 'test' } engine = create_engine( 'mysql+pymysql://%(user)s:%(password)s@%(host)s:%(port)d/%(database)s?charset=utf8' % db_info, encoding='utf-8') def mysql_replace_into(table, conn, keys, data_iter): from sqlalchemy.dialects.mysql import insert data = [dict(zip(keys, row)) for row in data_iter] stmt = insert(table.table).values(data) update_stmt = stmt.on_duplicate_key_update(**dict(zip(stmt.inserted.keys(), stmt.inserted.values()))) conn.execute(update_stmt) def write_database(df, table_name): df.to_sql(table_name, con=engine, index=False, if_exists='append', method=mysql_replace_into) if __name__ == '__main__': data = [ {\"app_id\": 1, \"app_secret\": \"11111122\", \"game_id\": 11}, {\"app_id\": 2, \"app_secret\": \"22222233\", \"game_id\": 22}, {\"app_id\": 3, \"app_secret\": \"33333344\", \"game_id\": 33} ] detailDF = pd.DataFrame(data) write_database(detailDF, \"ad_app_ext\") ","date":"2023-04-18","objectID":"/posts/python3-pandas-mysql-upsert/:0:0","tags":["python"],"title":"python3 pandas å®ç°mysql upsertæ“ä½œï¼ˆå”¯ä¸€é”®æ›´æ–°ï¼‰","uri":"/posts/python3-pandas-mysql-upsert/"},{"categories":["ç¼–ç¨‹"],"content":" sqoop export \\ --update-key unique_index_columns \\ --update-mode allowinsert é—®é¢˜æè¿°ï¼š ç”¨ä¸Šè¿°æ¨¡å¼ sqoop å¯¼å…¥æ•°æ®æ›´æ–° mysql æ•°æ®ï¼Œæ— è®ºå¯¼å…¥çš„æ•°æ®ä¸mysqlé‡Œæ•°æ®ç›¸æ¯”æœ‰æ²¡æœ‰æ›´æ–°ï¼Œmysqlè¡¨çš„ AUTO_INCREMENT çš„PRIMARY KEY ä¾‹å¦‚ ï¼ˆid int(11) NOT NULL AUTO_INCREMENT COMMENT â€˜è‡ªå¢ä¸»é”®â€™ï¼‰ å®é™…éƒ½æ˜¯å¢åŠ äº†çš„ï¼Œå½“æœ‰æ–°å”¯ä¸€ä¸»é”®æ•°æ®æ’å…¥æ—¶ï¼Œidä¼šæ˜¯ç´¯åŠ åçš„å¼€å§‹ï¼Œä¼šå˜çš„å¾ˆå¤§ã€‚ è§£å†³ï¼š sqoopæºç å±‚çº§æš‚æ—¶æ²¡çœ‹åŸå› ã€‚ã€‚ã€‚ å¯ä»¥ä»ä¸šåŠ¡æµç¨‹ä¸Šè§£å†³ä¸‹è¿™ä¸ªé—®é¢˜ï¼Œä¿è¯å¯¼å…¥çš„æ•°æ®éƒ½æ˜¯æ–°å¢æˆ–è€…æ›´æ–°çš„ï¼Œä¸ä¼šæœ‰ä¸mysqlä¸€æ ·çš„æ•°æ®ï¼Œå¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘ id çš„å¢é•¿ã€‚ ","date":"2023-04-18","objectID":"/posts/sqoop-mysql-update-auto-increment/:0:0","tags":["sqoop","å¤§æ•°æ®"],"title":"sqoop mysql update AUTO_INCREMENT è‡ªå¢ä¸»é”®é‡å¤å¢é•¿é—®é¢˜","uri":"/posts/sqoop-mysql-update-auto-increment/"},{"categories":["ç¼–ç¨‹"],"content":"è„šæœ¬ #! /bin/bash source /etc/profile set +o posix # to enable process substitution when not running on bash scala_file=$1 shift 1 arguments=$@ ##### scala æ–‡ä»¶ååŠ  sys.exit spark-shell --master yarn \\ --executor-cores 5 \\ --num-executors 4 \\ --executor-memory 8g \\ --driver-memory 3g \\ --conf spark.serializer=org.apache.spark.serializer.KryoSerializer \\ --conf spark.default.parallelism=400 \\ --conf spark.sql.shuffle.partitions=400 \\ --conf spark.shuffle.io.maxRetries=10 \\ --conf spark.shuffle.io.retryWait=20s \\ --conf spark.yarn.executor.memoryOverhead=4096 \\ --conf spark.network.timeout=300s \\ --name sparkshell_scala \\ -i \u003c(echo 'val args = \"'$arguments'\".split(\"\\\\s+\")' ; cat $scala_file) ç®€å•scalaæ–‡ä»¶ç¤ºä¾‹ val path = args(0) spark.read.parquet(path).where(\"app_id = 77701\").repartition(1).write.parquet(s\"${path}_new\") sys.exit å¦‚æœä¸éœ€è¦ä¼ å‚ï¼Œå¯ç®€å•ä½¿ç”¨ spark-shell \u003c test.scala ","date":"2023-04-18","objectID":"/posts/bash-spark-shell-scala/:0:0","tags":["å¤§æ•°æ®","spark","scala"],"title":"è„šæœ¬æ‰§è¡Œspark-shell scalaæ–‡ä»¶é€€å‡º","uri":"/posts/bash-spark-shell-scala/"},{"categories":["ç¼–ç¨‹"],"content":"èƒŒæ™¯ï¼š çº¿ä¸Škudu é›†ç¾¤ç‰ˆæœ¬ä¸º1.11.0ç‰ˆæœ¬, spark ä½¿ç”¨ kudu-spark2_2.11-1.7.0.jarï¼Œ ä¸ºäº†ä½¿ç”¨æ–°ç‰ˆæœ¬ä¸­çš„ val wo = new KuduWriteOptions(ignoreNull = true) ç‰¹æ€§ï¼Œå‡çº§è‡³ kudu-spark2_2.11-1.11.0.jar ç‰ˆæœ¬ï¼Œä½†æ˜¯æŠ¥é”™ã€‚ java.io.InvalidClassException: org.apache.kudu.spark.kudu.KuduContext; local class incompatible: stream classdesc serialVersionUID = xxxxxxxx, local class serialVersionUID = xxxxxxx111 åœ¨https://issues.apache.org/jira/browse/KUDU-2898 ä¸­è¯´è¿™ä¸ªå·²ç»ä¿®å¤ï¼Œä½†æ˜¯ä¿®å¤çš„ç‰ˆæœ¬æ˜¯kudu 1.12.0ï¼Œå‡çº§çº¿ä¸Škuduç‰ˆæœ¬è¿™ä¸ªæš‚æ—¶ä¸è€ƒè™‘ï¼Œåªå¥½è‡ªå·±ä¿®æ”¹æºç ï¼Œé‡æ–°ç¼–è¯‘ kudu-spark2_2.11-1.11.0.jar 1.è§£å‹ kudu-spark2_2.11-1.11.0.jar ï¼Œå°†è§£å‹å‡ºçš„æ‰€æœ‰æ–‡ä»¶å¤¹ç§»åŠ¨è‡³ä¸€ä¸ªç©ºæ–‡ä»¶å¤¹ï¼Œä¾‹å¦‚tmp 2.åœ¨ideaä¸­æ–°å»ºmavené¡¹ç›®ï¼Œé…ç½®å¥½ scala ç­‰ç¯å¢ƒ 3.è§£å‹ kudu-spark2_2.11-1.11.0-sources.jarï¼Œå°† å…¶ä¸­ org æ–‡ä»¶å¤¹ å¤åˆ¶ è‡³ mavenä¸­åˆšåˆšå»ºå¥½çš„é¡¹ç›®ä¸­ï¼ˆorg/apache/kudu/spark/kuduï¼‰ 4.ä¿®æ”¹æ–‡ä»¶ KuduContext.scala ã€ KuduRDD.scalaï¼Œ å¢åŠ æˆ–ä¿®æ”¹ @SerialVersionUID(xxxxxxxxxxL) ï¼Œxxxxxxxxxxæ”¹ä¸ºæŠ¥é”™ä¿¡æ¯ä¸­çš„local class serialVersionUID 5ï¼šOperationType.scalaæ–‡ä»¶ä¹Ÿéœ€ä¿®æ”¹ï¼Œå’Œ ä¸Šé¢çš„serialVersionUIDä¸åŒï¼Œèµ°å®Œæ•´ä¸ªæµç¨‹è¿è¡Œä¼šæŠ¥è¿™ä¸ªæ–‡ä»¶çš„serialVersionUIDé”™è¯¯ï¼Œæ”¹æˆé”™è¯¯ä¿¡æ¯ä¸­çš„local class serialVersionUID 6.å°† kudu-spark2_2.11-1.11.0.pom ä¸­çš„ dependencies ç²˜è´´è‡³ maven ä¸­é¡¹ç›®çš„pomæ–‡ä»¶ä¸­ï¼Œè¿˜éœ€é¢å¤–å¢åŠ ä»¥ä¸‹ä¾èµ–ï¼š \u003cdependency\u003e \u003cgroupId\u003eorg.apache.kudu\u003c/groupId\u003e \u003cartifactId\u003ekudu-client\u003c/artifactId\u003e \u003cversion\u003e1.11.0\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.apache.yetus\u003c/groupId\u003e \u003cartifactId\u003eaudience-annotations\u003c/artifactId\u003e \u003cversion\u003e0.13.0\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.hdrhistogram\u003c/groupId\u003e \u003cartifactId\u003eHdrHistogram\u003c/artifactId\u003e \u003cversion\u003e2.1.12\u003c/version\u003e \u003c/dependency\u003e 7.ideaä¸­å°†mavené¡¹ç›®æ‰“åŒ… 8.å°†ideaä¸­æ‰“å¥½çš„åŒ…è§£å‹ï¼Œå°†å…¶ä¸­ org/apache/kudu/spark/kudu ä¸‹çš„æ–‡ä»¶è¦†ç›–è‡³ tmp ä¸­ org/apache/kudu/spark/kudu 9.å°† tmp æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰ç›®å½•æ‰“åŒ…æˆæ–°çš„jaråŒ… å‚è€ƒé“¾æ¥ï¼š https://community.cloudera.com/t5/Support-Questions/KUDU-need-rebuild-post-upgrade-of-CDH-cluster/td-p/92885 https://issues.apache.org/jira/browse/KUDU-2898 ","date":"2023-04-18","objectID":"/posts/kudu-spark-invalid-class-exception/:0:0","tags":["å¤§æ•°æ®","kudu"],"title":"kudu-spark KuduContext  java.io.InvalidClassException è§£å†³","uri":"/posts/kudu-spark-invalid-class-exception/"},{"categories":["ç¼–ç¨‹"],"content":"é¡¹ç›®ç”¨åˆ°phoenixï¼Œä½¿ç”¨äº†è¿™ä¸ªjaråŒ…phoenix-client-4.14.1-HBase-1.4.jarï¼Œè¿™ä¸ªjaråŒ…å¯¼è‡´çš„jaråŒ…å†²çªå¾ˆå¤šï¼Œä¸€ç•ªæ‘¸ç´¢ï¼Œè§£å†³äº†ï¼Œè§£å†³å¦‚ä¸‹ã€‚ å…ˆjarå‘½ä»¤è§£å‹jaråŒ…ï¼Œç„¶ååˆ é™¤ä»¥ä¸‹å†…å®¹ã€‚ç„¶ååœ¨jarå‘½ä»¤æ‰“æˆjaråŒ…ã€‚ rm -r javax/ rm -r com/jayway/ rm -r org/apache/phoenix/shaded/org/apache/thrift rm -r com/sun/jersey/ ","date":"2023-04-18","objectID":"/posts/phoenix-client-hbase-jar/:0:0","tags":["å¤§æ•°æ®","hbase"],"title":"phoenix-client-4.14.1-HBase-1.4.jar jaråŒ…å†²çªè§£å†³","uri":"/posts/phoenix-client-hbase-jar/"},{"categories":null,"content":"è‡ªå¨±è‡ªä¹ï¼Œéšä¾¿å†™å†™ï¼Œéš¾å¾—è‡ªåœ¨! ä»äº‹å¤§æ•°æ®å¼€å‘å·¥ä½œï¼Œæ¬¢è¿äº¤æµã€‚ ","date":"2023-04-18","objectID":"/about/:0:0","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"è¿‘æœŸå“”å“” ","date":"2023-04-18","objectID":"/about/:0:1","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":["ç¼–ç¨‹"],"content":"å½“ hive è¡¨çš„åˆ†åŒºå­—æ®µ æ˜¯ date ç±»å‹æ—¶ï¼Œç”¨å¦‚ä¸‹æ–¹å¼è¯»å–ä¼šå‘ç”ŸæŠ¥é”™ã€‚ val targetDay = \"2020-08-20\" spark.read.table(tableName) .where(s\"targetday in (\" + s\"date_sub('$targetDay',59),\" + s\"date_sub('$targetDay',49),\" + s\"date_sub('$targetDay',39),\" + s\"date_sub('$targetDay',29),\" + s\"date_sub('$targetDay',14),\" + s\"date_sub('$targetDay',6),\" + s\"date_sub('$targetDay',5),\" + s\"date_sub('$targetDay',4),\" + s\"date_sub('$targetDay',3),\" + s\"date_sub('$targetDay',2),\" + s\"date_sub('$targetDay',1),\" + s\"date_sub('$targetDay',0))\" ).show targetday ä¸º è¡¨çš„åˆ†åŒºå­—æ®µï¼Œdateç±»å‹ã€‚ å½“ in åé¢ çš„æ—¥æœŸä¸ªæ•°å¤§äº 10 æ—¶å°±ä¼šæŠ¥é”™ï¼Œå°äºç­‰äº 10 æ—¶éƒ½ä¸ä¼šæŠ¥é”™ã€‚å¥‡æ€ªçš„ç°è±¡ã€‚ã€‚ã€‚ targetday ä¸º string ç±»å‹ä¸ä¼šæœ‰æ­¤é”™è¯¯ã€‚ ","date":"2023-04-17","objectID":"/posts/spark-hive-partition-issue/:0:0","tags":["spark","å¤§æ•°æ®"],"title":"spark è¯»å– hive date åˆ†åŒºè¡¨ å¥‡æ€ªçš„æŠ¥é”™","uri":"/posts/spark-hive-partition-issue/"},{"categories":["ç¼–ç¨‹"],"content":"çº¿ä¸Šé¡¹ç›®å‡ºç°ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„é—®é¢˜ï¼Œæ•°æ®ç»è¿‡Sparkç¨‹åºæ¶ˆè´¹Kafkaå†™å…¥Kuduï¼Œå‡ºç°Kudu Masterè¿æ¥è¶…æ—¶ï¼Œè¿™ä¸ªé—®é¢˜å¼€å§‹æ’æŸ¥ä¸å‡ºåŸå› ï¼Œæœ‰ç‚¹å¤´å¤§ï¼Œåªèƒ½é‡‡ç”¨ä¸‹ä¸‹ç­–ï¼Œé‡å¯Sparkç¨‹åºï¼Œå‡ºç°è¿‡å‡ æ¬¡åï¼Œ æˆ‘è®°å½•äº†å‡ºç°çš„æ—¶é—´ï¼Œå‘ç°æ¯æ¬¡å‡ºç°æ—¶é—´æœ‰ä¸ªå›ºå®šå‘¨æœŸï¼Œä¸€å‘¨ï¼Œæœ‰è§„å¾‹å°±æ˜¯æœ€å¤§çš„å¥½æ¶ˆæ¯ï¼Œæ„Ÿè§‰ç¦»å‘ç°çœŸç›¸ä¸è¿œäº†ï¼Œæœç„¶ç½‘ä¸Šæœ‰è¿™æ–¹é¢çš„é—®é¢˜è®¨è®ºï¼Œè™½è¯´ä»¥å‰ä¹Ÿå»ç½‘ä¸Šæœç´¢è¿‡ç›¸å…³é—®é¢˜ï¼Œæ¯•ç«ŸKuduç›¸æ¯”äºHiveã€HBaseè¿˜æ˜¯å°ä¼—äº†ä¸€ç‚¹ã€‚ã€‚ã€‚æ˜¯Kudu Java Clientçš„é—®é¢˜ï¼Œä½¿ç”¨1.5ä»¥ä¸Šç‰ˆæœ¬å°±æ²¡é—®é¢˜äº†ã€‚ å‚è€ƒï¼šå…³äºkuduä½¿ç”¨çš„ä¸€äº›é—®é¢˜åŠè§£å†³åŠæ³• ","date":"2023-04-17","objectID":"/posts/kudu-periodic-issues/:0:0","tags":["kudu","å¤§æ•°æ®"],"title":"Apache Kudu å†™å…¥æ•°æ®å®šæœŸå‡ºé—®é¢˜","uri":"/posts/kudu-periodic-issues/"},{"categories":["ç¼–ç¨‹"],"content":"æœ€è¿‘çº¿ä¸Šçš„sparké¡¹ç›®æ—¥å¿—æ–‡ä»¶æ€¥å‰§å¢åŠ ï¼Œç£ç›˜é¡¶ä¸ä½äº†å•Šï¼Œè§£å†³æ—¥å¿—æ–‡ä»¶é—®é¢˜ï¼Œå‚è€ƒä¸‹é¢ä¸‰ç¯‡æ–‡ç« ï¼ŒåŸºæœ¬å°±å¯ä»¥ææ˜ç™½äº†ã€‚ Sparkæ—¥å¿—è¿‡å¤§å¯¼è‡´ç£ç›˜æº¢å‡ºé—®é¢˜è§£å†³æ–¹æ¡ˆ Sparkæ—¥å¿—é…ç½®åŠé—®é¢˜æ’æŸ¥æ–¹å¼ã€‚ Spark log4j æ—¥å¿—é…ç½®è¯¦è§£ ä»¥ä¸Šå†…å®¹è½¬è½½è‡ªç½‘ç»œï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»åˆ é™¤ã€‚ ","date":"2023-04-17","objectID":"/posts/spark-yarn-cluster-log4j/:0:0","tags":["spark","å¤§æ•°æ®"],"title":"spark yarn clusteræ¨¡å¼ä¸‹log4jæ—¥å¿—çš„é…ç½®","uri":"/posts/spark-yarn-cluster-log4j/"},{"categories":["åˆ†äº«"],"content":"è½¬è½½è‡ªç½‘ç»œï¼Œä¸ä¿è¯å¯ç”¨æ€§åŠæ˜¯å¦æ‹¥æœ‰ç‰ˆæƒï¼Œä»…ä¾›åˆ†äº«ï¼Œå¦‚æœ‰æ³•å¾‹çº çº·ï¼Œè¯·è”ç³»åˆ é™¤ã€‚ å›½å†…ç½‘ç«™ 1ã€é¸ æ‘©æœä¹¦ ç½‘å€ï¼šhttps://www.jiumodiary.com/ ä¸€ä¸ªå¼ºå¤§çš„æœä¹¦ç¥ç«™ï¼Œæ— è®ºæ˜¯ä»€ä¹ˆç±»å‹çš„ä¹¦ç±ï¼Œåªè¦ä½ çŸ¥é“ä¹¦åï¼Œå°±å¯ä»¥è½»æ¾çš„æœåˆ°ä½ æƒ³è¦ä¹¦ç±ã€‚é¡µé¢ç®€å•æ˜äº†ï¼Œä¹¦ç±ç§ç±»ç¹å¤šï¼Œæ ¼å¼å¤šç§å¤šæ ·ï¼Œæœ‰mobiæ ¼å¼ã€pdfæ ¼å¼ã€wordæ ¼å¼ã€txtæ ¼å¼ç­‰ã€‚å…³é”®æ˜¯å¯ä»¥æ— é™ä¸‹è½½ï¼Œæ— éœ€æ³¨å†Œç™»å½•ã€‚ 2ã€å‘¨è¯» ç½‘å€ï¼šhttp://www.ireadweek.com/index.php/Index/index.html å‘¨è¯»æ˜¯ä¸€ä¸ªæä¾›ä¼˜è´¨çš„epud,mobi,pdf,txtç”µå­ä¹¦ä¸‹è½½å’Œåˆ†äº«çš„ç½‘ç«™ï¼Œå¸®åŠ©ä¸çŸ¥é“è¯»ä»€ä¹ˆä¹¦çš„ç”¨æˆ·ï¼Œé€‰æ‹©å€¼å¾—è¯»çš„å¥½ä¹¦ç±ï¼Œè¯¥ç½‘ç«™æä¾›å¤šç§ä¹¦ç±åˆ†ç±»ï¼Œæ¶µç›–äº†å¤§å¤šæ•°çš„å¯è¯»ä¹¦ç±ã€‚ 3ã€æˆ‘çš„å°ä¹¦å±‹ ç½‘å€ï¼šhttp://mebook.cc/ å…è´¹æ— å¹¿å‘Šã€ç”µå­ä¹¦çš„è´¨é‡å¾ˆå¥½ï¼Œå›¾ä¹¦éƒ½æ˜¯ç»è¿‡ç«™é•¿ç²¾æŒ‘ç»†é€‰çš„ã€‚ç½‘ç«™åˆ†ä¸ºç•…é”€å°è¯´ã€ç½‘ç»œå°è¯´ã€åˆé›†èµ„æºã€å¤šçœ‹ä¸“åŒºã€æ‚å¿—æœŸåˆŠã€æ¼«ç”»ã€å·¥å…·ä¹¦ã€åŸç‰ˆä¹¦ç±ã€è½»å°è¯´ç­‰æ¨¡å—ã€‚ç«™é•¿æ¯å¤©éƒ½ä¼šæ¨èæ›´æ–°å‡ æœ¬ä¹¦ï¼Œä¹¦å¤ªå¤šä¸çŸ¥é“è¯»ä»€ä¹ˆï¼Œå°±è¯•è¯•ç«™é•¿æ¨èçš„å§ã€‚ 4ã€ä¹¦æ ¼ ç½‘å€ï¼š https://shuge.org/ ä¹¦æ ¼æ˜¯ä¸€ä¸ªè‡ªç”±å¼€æ”¾çš„åœ¨çº¿å¤ç±å›¾ä¹¦é¦†ï¼Œè‡´åŠ›äºå¼€æ”¾å¼åˆ†äº«ã€ä»‹ç»ã€æ¨èå¤æœ¬ï¼ˆå››ä¹ä»¥å‰çš„å½±åƒæœ¬ï¼‰PDFï¼›ç½‘ç«™è‡´åŠ›äºä¸ºå¤ç±çš„ä¿æŠ¤ä¸æ•°å­—åŒ–ä¼ æ’­è´¡çŒ®ã€‚ 5ã€è¥¿æ—è¡—æœç´¢ ç½‘å€ï¼šhttp://www.xilinjie.com/ ä¸“æ³¨äºç½‘ç›˜ã€è§†é¢‘ã€æ–‡åº“ï¼ˆæ–‡æ¡£ã€å¤ç±ã€ä¸“ä¸šä¹¦ç±ã€ç”µå­ä¹¦PDFã€ePubã€Mobiç­‰æ ¼å¼ï¼‰ã€å­¦æœ¯ï¼ˆå„ç§æœŸåˆŠã€è®ºæ–‡ã€å­¦æŠ¥ç­‰ï¼‰å’ŒMoocï¼ˆåœ¨çº¿è¯¾ç¨‹ã€å­¦ä¹ ã€è§†é¢‘æ•™ç¨‹ï¼‰ç­‰èµ„æºçš„æœç´¢ã€‚ 6ã€å¥½è¯» ç½‘å€ï¼šhttp://haodoo.net å…è´¹çš„çº¿ä¸Šç¹ä½“ä¸­æ–‡å›¾ä¹¦é¦†ï¼Œå¯åœ¨çº¿é˜…è¯»åŠä¸‹è½½ï¼Œå¯ä¸‹è½½çš„æ ¼å¼æœ‰ï¼šupdbï¼Œpdbï¼Œprcï¼Œepubã€‚ 7ã€å›¾çµç¤¾åŒº ç½‘å€ï¼šhttp://www.ituring.com.cn/ å›¾çµç¤¾åŒºä¸»è¦ä¸“æ³¨äºç§‘æŠ€ä¹¦ç±çš„å‡ºç‰ˆï¼ŒåŒ…æ‹¬è®¡ç®—æœºã€æ•°å­¦ç»Ÿè®¡ã€ç§‘æ™®ç­‰é¢†åŸŸï¼Œæä¾›å…è´¹å’Œä»˜è´¹çš„ç”µå­ä¹¦ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨ç½‘é“¶æˆ–è€…æ”¯ä»˜å®çš„è´­ä¹°æ–¹å¼ï¼Œå¤§éƒ¨åˆ†ç”µå­ä¹¦åŒæ—¶æä¾›äº†ä¸‰ç§é˜…è¯»æ–¹å¼ï¼šåœ¨çº¿é˜…è¯»ã€MOBI æ¨é€ã€PDF ä¸‹è½½ï¼Œéƒ¨åˆ†ä¹¦ç±åªæä¾›å…¶ä¸­éƒ¨åˆ†æ ¼å¼ã€‚ 8ã€ç›˜æœ ç½‘å€ï¼šhttp://www.pansoso.com/ ä¸€ä¸ªè€ç‰Œç½‘ç›˜æœç´¢å·¥å…·ï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œç•Œé¢éå¸¸ç®€æ´ã€‚æ¯å¤©éƒ½æœ‰æ›´æ–°ï¼Œä¸åŒè¾¾äººåˆ†äº«è‡ªå·±çš„â€œç›˜ä¸­èµ„æºâ€ï¼ç›˜æœä¸å­˜å‚¨ä»»ä½•ç½‘ç›˜å†…å®¹ï¼Œä½†æ˜¯èµ„æºéå¸¸ä¸°å¯Œï¼Œæ— è®ºæ˜¯å·¥ä½œè¿˜æ˜¯å­¦ä¹ éƒ½å¿…å¤‡ã€‚ 9ã€è‹¦ç“œä¹¦ç›˜ ç½‘å€ï¼šhttps://kgbook.com/ è‹¦ç“œä¹¦ç›˜,ç”µå­ä¹¦åˆ†äº«çš„å¹³å°ã€‚é€‚åˆç”µçº¸ä¹¦é˜…è¯»çš„6å¯¸pdfåŠmobiæ ¼å¼ç”µå­ä¹¦åˆ¶ä½œæŠ€æœ¯çš„ç½‘ç«™ã€‚ 10ã€æ–°æµªçˆ±é—®å…±äº«èµ„æ–™ ç½‘å€ï¼šhttp://ishare.iask.sina.com.cn/ æ–°æµªçˆ±é—®å…±äº«èµ„æ–™æ˜¯æ–°æµªæ——ä¸‹çš„åœ¨çº¿èµ„æ–™åˆ†äº«ç«™ï¼Œå…è´¹é«˜é€Ÿä¸Šä¼ æˆ–ä¸‹è½½å„ç±»èµ„æºï¼Œå†…å®¹æ¶‰åŠæ•™è‚²èµ„æºã€ä¸“ä¸šèµ„æ–™ã€ITçš„èµ„æ–™ã€å¨±ä¹ç”Ÿæ´»ã€ç»æµç®¡ç†ã€åŠå…¬æ–‡ä¹¦ã€æ¸¸æˆèµ„æ–™ç­‰ã€‚å¦‚æœä½ è¦å¯»æ‰¾åå­¦æœ¯çš„èµ„æ–™ï¼Œæ‰€æœ‰åœ°æ–¹éƒ½æ‰¾ä¸åˆ°ï¼Œå¯ä»¥æ¥è¿™é‡Œè¯•è¯•ï¼Œä¸€èˆ¬ä¸ºæ‰«æç‰ˆPDFã€‚ 11ã€Eä¹¦è”ç›Ÿ ç½‘å€ï¼šhttp://www.book118.com/ Eä¹¦è”ç›Ÿæ˜¯ä¸€ä¸ªåºå¤§çš„å…è´¹ä¸­æ–‡ç”µå­ä¹¦ä¸‹è½½ç«™ï¼Œæä¾›å„ç±»ç”µå­ä¹¦ä¸‹è½½ï¼Œå…¶ä¸­å«æ¯”è¾ƒä¸“ä¸šçš„ç”µå­å›¾ä¹¦ï¼Œæä¾›éƒ¨åˆ†ç”µå­ä¹¦åœ¨çº¿é˜…è¯»ã€‚ 12ã€äº‘æµ·ç”µå­å›¾ä¹¦é¦† ç½‘å€ï¼šhttp://www.pdfbook.cn/ äº‘æµ·ç”µå­å›¾ä¹¦é¦†æ˜¯è‡´åŠ›äºpdfç”µå­ä¹¦çš„ä¸“ä¸šç½‘ç«™,æä¾›å„é—¨ç±»pdfç”µå­ä¹¦ä¸‹è½½åŠé«˜æ¸…pdfç”µå­ä¹¦ã€‚ 13ã€ä¸‡åƒé›†åˆç«™ ç½‘å€ï¼šhttp://www.hejizhan.com/html/search åŒ…å«éå¸¸å¤šçš„æ•™æç±»ç›¸å…³ç”µå­ä¹¦ç±ï¼Œæœç´¢åç›´æ¥æ˜¾ç¤ºä¸‹è½½é“¾æ¥ã€‚æœç´¢ç»“æœåŸºæœ¬æ¶µç›–äº†æ‰€æœ‰ç‰ˆæœ¬çš„ç”µå­æ•™æã€ä¹ é¢˜è¯¦è§£ç­‰ã€‚å¦‚æœä¸Šå¤§å­¦æ—¶æœ‰è¿™ç§èµ„æºï¼Œå°±çœä¸‹å¥½å¤šä¹°æ•™æã€ä¹ é¢˜è§£ç­”çš„é’±äº†ã€‚ 14ã€èš‚èšæœä¹¦ ç½‘å€ï¼šhttp://book.mybanshu.win/ ITä¹¦æ›´å¤šçš„èµ„æºç½‘ç«™ï¼Œæ”¯æŒä¸‹è½½ï¼Œä¸æ”¯æŒkindleæ¨é€ã€‚æ³¨å†Œéœ€è¦åŠ å¾®ä¿¡ç´¢è¦é‚€è¯·ç ï¼Œä¹Ÿæ˜¯ç®¡ç†å¾ˆä¸¥æ ¼äº†ã€‚ 15ã€ä¹¦è¯­è€… ç½‘å€ï¼šhttps://book.shuyuzhe.com/ ä¹¦è¯­è€…ç”µå­å›¾ä¹¦é¦†ï¼Œä¸€ä¸ªæœä¹¦ç½‘ç«™ï¼Œè®©ä½ å¿«é€Ÿæ‰¾åˆ°æƒ³è¦çš„ä¹¦ç±ï¼ 16ã€è®¡ç®—æœºä¹¦æ§ ç½‘å€ï¼šhttp://bestcbooks.com/ è¿™ä¸ªç½‘ç«™å¯è°“æ˜¯è®¡ç®—æœºä¸“ä¸šçš„ç¦éŸ³ï¼Œè¿™é‡ŒåŒ…å«è®¸å¤šä¼˜ç§€çš„è®¡ç®—æœºä¹¦ç±ä¸‹è½½ã€‚æ— è®ºæ˜¯è‹±æ–‡åŸç‰ˆè¿˜æ˜¯ä¸­æ–‡è¿™é‡Œéƒ½æœ‰ã€‚ 17ã€å½±å°å¤ç±èµ„æ–™ ç½‘å€ï¼šhttps://sou-yun.com/eBookIndex.aspx æä¾›7000+ç§å¤ç±èµ„æ–™çš„ç½‘ä¸Šé˜…è¯»å’ŒPDFæ ¼å¼ä¸‹è½½æœåŠ¡ã€‚ 18ã€çŸ¥è½©è—ä¹¦ ç½‘å€ï¼šhttp://www.zxcs8.com/ è¿™æ˜¯ä¸€ä¸ªå°è¯´ç½‘ç«™ï¼Œåœ¨è¿™é‡Œä½ å¯ä»¥æ‰¾åˆ°ä½ æƒ³è¦çš„å°è¯´ã€‚ 19ã€å›½å­¦ç½‘ åœ°å€ï¼šhttp://www.guoxue.com/ ä¸€å®¶åœ¨å›½å­¦ä¼ æ’­é¢†åŸŸç‹¬å…·ç‰¹è‰²çš„æ–‡åŒ–åˆ›æ„ä¼ä¸šï¼Œä¸»è¦ä»äº‹å¤ç±æ•°å­—åŒ–ç ”ç©¶ã€ç½‘ç»œæ–‡çŒ®æ£€ç´¢å¼€å‘å’Œç½‘ç«™å»ºè®¾ï¼Œæ˜¯ä¸­å›½æœ€å¤§çš„ä¸“ä¸šå¤ç±ç”µå­æ–‡çŒ®æ•°æ®å…¬å¸ä¹‹ä¸€ã€‚ 20ã€å›½å®¶æ•°å­—å›¾ä¹¦é¦† ç½‘å€ï¼š http://www.nlc.gov.cn/index.htm å¤§é‡åœ¨çº¿èµ„æºã€å­æ•°æ®åº“ã€å¯ä»¥åœ¨çº¿é˜…è¯»æµ·é‡ç”µå­ä¹¦ï¼Œéœ€è¦æ³¨å†Œï¼ˆå®åæ³¨å†Œã€éœ€è¦èº«ä»½è¯å·ï¼‰ã€‚å›½å›¾è´­ä¹°äº†å¤§é‡èµ„æºï¼Œæœ‰è´¦å·ï¼Œä¾¿å¯åœ¨çº¿é˜…è¯»æˆ–è€…ä¸‹è½½ï¼Œç‰ˆæƒæœŸé™å†…çš„å›¾ä¹¦åªèƒ½è¯»å‰ä¸¤ç« ï¼Œæ°‘å›½å›¾ä¹¦å’Œå¤ç±åˆ™å¯é˜…è¯»å…¨éƒ¨å†…å®¹ã€‚ 21ã€PDFä¹‹å®¶ ç½‘å€ï¼š http://www.pdfzj.com/ PDFä¹‹å®¶ï¼Œåšä¸­å›½æœ€å¥½çš„pdfèµ„æºç«™ï¼Œè‡´åŠ›æœ€å…¨æœ€æ–°çš„pdfæ‚å¿—ã€æœŸåˆŠæ‚å¿—ã€ç”µå­æ‚å¿—ã€ç”µå­å›¾ä¹¦çš„å…è´¹åˆ†äº«å’Œä¸‹è½½æœåŠ¡ã€‚ 22ã€æˆ‘çˆ±è¯»ç”µå­ä¹¦ ç½‘å€ï¼šhttp://www.woaidu.org/ æˆ‘çˆ±è¯»ç”µå­ä¹¦æ˜¯æƒå¨ç”µå­ä¹¦æœç´¢å¼•æ“ï¼Œå¯ä»¥ä½¿ç”¨æˆ‘çˆ±è¯»ç”µå­ä¹¦å¿«é€Ÿçš„æ‰¾åˆ°è‡ªå·±å–œæ¬¢çš„ç”µå­ä¹¦ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¹¦æ¦œäº†è§£æœ€æ–°æœ€çƒ­é—¨çš„ä¹¦ï¼Œéšæ—¶éšåœ°ç•…æƒ³è‡ªå·±å–œæ¬¢çš„ä¹¦ã€‚ 23ã€é«˜æ¸…æ‚å¿—ç½‘ ç½‘å€ï¼šhttp://www.gqzzw.com/ é«˜æ¸…æ‚å¿—ç½‘æä¾›æ‚å¿—å›½å†…çƒ­é—¨åŸç‰ˆé«˜æ¸…ç”µå­æ‚å¿—ä¸‹è½½æœåŠ¡,ç›®å‰æœ‰è´¢ç»ç†è´¢ã€ç”µè„‘æ•°ç ã€æ•…äº‹ä¼ å¥‡ã€å©šå§»å®¶åº­ã€å¥åº·å…»ç”Ÿã€æ•™è‚²æ•™å­¦ã€ç»æµæ³•å¾‹ã€ç§‘æŠ€ç§‘æ™®ã€æ—…æ¸¸æ°‘ä¿—ã€å¥³æ€§æ‚å¿—ç­‰ç­‰ã€‚ 24ã€è¶…æ˜Ÿç”µå­ä¹¦ ç½‘å€ï¼šhttp://www.chaoxing.com 40ä¸‡ç”µå­ä¹¦ï¼Œæ³¨å†Œåå¯ä»¥åœ¨çº¿æˆ–ä½¿ç”¨å®¢æˆ·ç«¯é˜…è¯»æµ·é‡ä¹¦ç±ã€‚è‹¥åœ¨æ•™è‚²ç½‘ä¸­ï¼Œæ¨èåŒ…åº“ç½‘å€ ï¼Œå¯ä»¥å°†PDGæ ¼å¼ç”µå­ä¹¦ä¸‹è½½åˆ°æœ¬æœºä¸Šç¦»çº¿é˜…è¯»ã€‚pdgå¦‚ä½•è½¬æˆpdfï¼Œè¯·çœ‹ç™¾åº¦ç»éªŒ ã€‚è¯¥ç«™å…±äº«èµ„æ–™é¡µä¹Ÿæœ‰å¤§é‡èµ„æºã€‚ 25ã€èµ°è¯»æ´¾ åœ°å€ï¼šhttp://zoudupai.com ç€‘å¸ƒæµç”µå­ä¹¦ç½‘ç«™ï¼Œæ”¯æŒä¸‹è½½å’Œæ¨é€ï¼Œæ³¨å†Œç™»é™†åæ— å…¶ä»–é™åˆ¶ï¼Œä½†æ˜¯ä¹¦ä¸å¤šï¼Œä¸Šä¼ èµ„æºéœ€è¦å…ˆç”³è¯·ã€‚èµ„æºè´¨é‡æœ‰å¾…ä¼˜åŒ–ã€‚å…¶ä¹¦è¯„ç³»ç»Ÿ #ä¹¦ç“¦å°# å½¢å¼æ¥è¿‘å¾®åšã€‚ 26ã€æŒä¸Šä¹¦è‹‘ åœ°å€ï¼šhttps://www.cnepub.com/ Epubæ ¼å¼ç”µå­ä¹¦ä¸‹è½½ç«™ï¼Œä¸‹è½½å’Œæ¨é€å‡ä¸ºä»˜è´¹æœåŠ¡ï¼Œä½†æ˜¯å¯ä»¥å…è´¹åœ¨çº¿é˜…è¯» 27ã€ä¼—äººæœç´¢ç½‘ ç½‘å€ï¼šhttp://dianzishu.renrensousuo.com/ ä¸€ä¸ªç”µå­ä¹¦æœç´¢åŠŸèƒ½çš„ç½‘ç«™ï¼Œå¯ä»¥åŒæ—¶æœç´¢å„ç±»ç”µå­ä¹¦ã€ç”µå­å°è¯´ç­‰ã€‚ 28ã€èƒ–æ¬¡æœç´¢ ç½‘å€ï¼šhttps://www.panc.cc/ èƒ–æ¬¡çš„æœç´¢ç»“æœéœ€è¦é…åˆç¹ä½“å­—æ‰èƒ½æœ‰æœ€ä½³æ•ˆæœï¼Œæ•´ä½“æ¥è¯´èƒ–æ¬¡è¿˜è›®å¥½ç”¨çš„ï¼Œè¿éšç§˜ç»è¿¹çš„è®²åº§å½•éŸ³/ç¬”è®°éƒ½æœ‰ï¼Œè¿™ä¸ªå¿…é¡»ç»™ç‚¹ä¸ªèµï¼ç•Œé¢åšçš„ä¹ŸæŒºç®€æ´ï¼Œèµ„æºæ–¹é¢è¯´å®è¯ä¹Ÿå¤Ÿçœ‹äº†ã€‚èƒ–æ¬¡å¯æœç´¢å½±éŸ³è§†é¢‘ã€éŸ³ä¹æ­Œæ›²ã€å°è¯´æ–‡æ¡£ã€ç¨‹åºAppã€å›¾ç‰‡å£çº¸ã€å‹ç¼©æ–‡ä»¶BTç§å­ç­‰èµ„æºï¼›èƒ–æ¬¡æœç´¢å¦‚æœæ˜¯æ— æ•ˆèµ„æºï¼Œä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œè¿™ä¸ªå¾ˆæ–¹ä¾¿ã€‚ 29ã€ç›˜å¤šå¤š ç½‘å€ï¼šhttp://www.panduoduo.net/ çƒ­é—¨èµ„æºã€ä¸“ä¸šèµ„æºæ–¹é¢å‡ºæ¥çš„ç»“æœéƒ½å¾ˆæ£’ã€‚office2016ï¼Œå„ç§‘ç›®çš„æ–‡çŒ®èµ„æ–™éƒ½æœ‰ï¼Œåªè¦ç‚¹å‡»é“¾æ¥ï¼Œå°±èƒ½è¿›å…¥è¯¦ç»†é¡µé¢è¿›è¡Œä¸‹è½½ï¼Œåœ¨é¡µé¢ä¸‹æ–¹ï¼Œä¹Ÿåˆ—å‡ºäº†å…¶ä»–ç›¸å…³èµ„æºï¼Œå…¨ç«™æ— è¯±å¯¼ä¸‹è½½çš„å‡æŒ‰é’®ï¼ŒçœŸå¿ƒä¸é”™ã€‚å°é—®é¢˜ï¼šèµ„æºæœ€ä¸°å¯Œï¼Œä½†æ˜¯å¶å°”ä¸ç¨³å®šã€‚ 30ã€å»è½¬ç›˜ç½‘ ç½‘å€ï¼šhttp://www.quzhuanpan.com/ å»è½¬ç›˜æœ‰ç€é£æ™¯å®œäººçš„ç•Œé¢ï¼Œæ˜¯ä¸€ä¸ªç½‘ç›˜æœç´¢å¼•æ“ï¼Œå¯ä»¥æœç´¢btå’Œç½‘ç›˜èµ„æºè¿˜æœ‰èµ„æºåˆ†äº«ç­‰åŠŸèƒ½ï¼Œæœç´¢ç±»å‹ä¸»è¦æœ‰å½±è§†ã€éŸ³ä¹ã€ç”µå­ä¹¦ã€ç§å­ã€è½¯ä»¶ç­‰å„ç§èµ„æºï¼Œæœç´¢ç½‘ç›˜ä¸ºç™¾åº¦ç½‘ç›˜ã€‚åŒæ—¶å¼€å‘äº†PCç«¯å’Œappå®¢æˆ·ç«¯ï¼Œé“¾æ¥é¾™è½©å¯¼èˆªã€å“”å“©å“”å“©ã€å’ªå’•é±¼ç­‰ç½‘ç«™ï¼ŒåŠŸèƒ½ååˆ†å¼ºå¤§ã€‚ 31ã€éº¦åº“æœç´¢ ç½‘å€ï¼šhttp://huisou.me/ éº¦åº“æœç´¢ç•Œé¢ç›¸å½“ç®€çº¦ï¼Œä½†ä¸å½±å“å…¶å¼ºå¤§çš„æœç´¢åŠŸèƒ½ã€‚éº¦åº“æ˜¯åˆ©ç”¨Googleåˆ›å»ºçš„ä¸€ç³»åˆ—å‚ç›´æœç´¢å¼•æ“ï¼Œæ‰€ä»¥Googleçš„ä¸€äº›ä½¿ç”¨æŠ€å·§åŒæ ·é€‚åˆäºéº¦åº“æœç´¢ã€‚éº¦åº“æ•°æ®æ¥æºï¼šç™¾åº¦ç½‘ç›˜ï¼Œæ–°æµªå¾®ç›˜ç­‰ã€‚ 32ã€ç‰¹ç™¾åº¦ ç½‘å€ï¼šhttp://www.tebaidu.com/ ç‰¹ç™¾åº¦äº‘æä¾›ç™¾åº¦äº‘æ——ä¸‹çš„ç™¾åº¦ç½‘ç›˜æœç´¢ä¸‹è½½ç™¾åº¦ç½‘ç›˜çš„èµ„æºï¼Œæœ¬ç«™ä¹Ÿæ”¯æŒç™¾åº¦ç½‘ç›˜ç™»é™†ï¼Œç™¾åº¦ç½‘ç›˜æ˜¯ç›®å‰å—æ¬¢è¿çš„Tçº§è¶…å¤§å…è´¹ç½‘ç›˜ï¼Œæ³¨å†Œç”¨æˆ·è¿‡äº¿ã€‚ 33ã€å²è±å§†æœç´¢ ç½‘å€ï¼šhttp://www.slimego.cn/ æœ€ä¸°å¯Œçš„å­¦ä¹ èµ„æ–™åº“,æ”¶é›†æ•´ç†äº†å¤§é‡å…è´¹èµ„æº,æ•™å­¦èµ„æº,ç™¾åº¦äº‘èµ„æº,ç½‘ç›˜èµ„æºã€‚åŒ…å«ä¸»æµçš„èµ„æºæœç´¢å¤–,è¿˜èƒ½æ‰¾åˆ°å„è¡Œä¸šç»†åˆ†çš„å­¦ä¹ èµ„æºã€‚ å›½å¤–ç½‘ç«™ 34ã€Library Genesis ç½‘å€ï¼šhttp://gen.lib.rus.ec/ è¿™ä¸ªç•Œé¢ç®€æ´æ˜äº†ï¼Œè¾“å…¥ä½ æƒ³è¦æ‰¾çš„å…³é”®è¯æˆ–è€…å…¨åï¼Œå°±å¯ä»¥æœåˆ°è¯¥é¢†åŸŸçš„ä¸€äº›ç”µå­ä¹¦ç±ã€‚ä¸€äº›ç§‘ç ”çš„ç”µå­ä¹¦ï¼Œè¿˜æœ‰ç§‘ç ”è®ºæ–‡ã€å°è¯´ã€å–œå‰§ã€è¡Œä¸šæ ‡å‡†ã€æ‚å¿—å•¥çš„éƒ½å¯ä»¥æœæœè¯•è¯•ã€‚ä»è¿™ä¸ªç½‘ç«™æœç´¢å¯ä»¥æœå‡ºä¸€æœ¬ä¹¦çš„å¥½å¤šç‰ˆæœ¬ï¼Œå¤§å®¶æ ¹æ®è‡ªå·±çš„éœ€æ±‚ä¸‹è½½ã€‚ 35ã€Project Gutenberg ç½‘å€ï¼šhttp://www.gutenberg.org/ å®ƒæ˜¯å›½å¤–ä¸€ä¸ªçŸ¥åçš„ç”µå­ä¹¦å…è´¹åˆ†äº«ç½‘ç«™ï¼Œæ—¨åœ¨åŸºäºäº’è”ç½‘ï¼Œå¤§é‡æä¾›ç‰ˆæƒè¿‡æœŸè€Œè¿›å…¥å…¬æœ‰é¢†åŸŸä¹¦ç±çš„ä¸€é¡¹åä½œè®¡åˆ’ï¼Œ","date":"2023-04-17","objectID":"/posts/book-search-website/:0:0","tags":["æ‚é¡¹"],"title":"äº”åä¸ªç”µå­ä¹¦æœç´¢ç½‘","uri":"/posts/book-search-website/"},{"categories":["ç¼–ç¨‹"],"content":"é…ç½®å¥½ä¸‹é¢ä¸‰ä¸ªå±æ€§ã€‚ \u003c!-- è¶…è¿‡æ—¶é—´é™åˆ¶æ˜¯å¦å›æ”¶ --\u003e \u003cproperty name=\"removeAbandoned\" value=\"true\" /\u003e \u003c!-- è¶…æ—¶æ—¶é—´ï¼›å•ä½ä¸ºç§’ã€‚180ç§’=3åˆ†é’Ÿ --\u003e \u003cproperty name=\"removeAbandonedTimeout\" value=\"180\" /\u003e \u003c!-- å…³é—­abandedè¿æ¥æ—¶è¾“å‡ºé”™è¯¯æ—¥å¿— --\u003e \u003cproperty name=\"logAbandoned\" value=\"true\" /\u003e æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ã€‚ 2019-04-17 17:10:05:140 - ERROR [Druid-ConnectionPool-Destroy-1559154670] - com.alibaba.druid.pool.DruidDataSource com.alibaba.druid.pool.DruidDataSource.removeAbandoned:2666 abandon connection, owner thread: http-nio-8085-exec-1, connected at : 1555491605100, open stackTrace at java.lang.Thread.getStackTrace(Thread.java:1559) at com.alibaba.druid.pool.DruidDataSource.getConnectionDirect(DruidDataSource.java:1313) at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:1235) at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:1225) at com.xxxx.xx.common.util.JdbcUtil.linkTrace(JdbcUtil.java:39) at com.xxxx.xx.xxxxx.service.impl.DashboardServiceImpl.getExpenTrend(DashboardServiceImpl.java:263) at com.xxxx.xx.xxxxx.service.impl.DashboardServiceImpl.getBossData(DashboardServiceImpl.java:58) at com.xxxx.xx.xxxxx.controller.DashboardController.getBossData(DashboardController.java:43) æ—¥å¿—é‡ŒæŸ¥æ‰¾removeAbandonedå…³é”®å­—ï¼Œæ‰¾åˆ°è‡ªå·±å“ªä¸ªæ–¹æ³•è·å–è¿æ¥åæ²¡æœ‰å…³é—­èµ„æºï¼Œæ’æŸ¥åŸå› ã€‚ ","date":"2023-04-17","objectID":"/posts/druid-connect-not-free/:0:0","tags":["java"],"title":"é˜¿é‡ŒDruidè¿æ¥æ± è¿æ¥ä¸é‡Šæ”¾ã€è¿æ¥æ³„æ¼æ’æŸ¥","uri":"/posts/druid-connect-not-free/"},{"categories":["ç¼–ç¨‹"],"content":"æœ€è¿‘ç”¨åˆ°é˜¿é‡Œäº‘ossï¼Œæœ‰é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼Œé€šè¿‡ä»£ç†å†…ç½‘è®¿é—®å¯ä»¥å®ç°å…é™¤OSSæµé‡è´¹ï¼ŒæŸ¥åˆ°å¾ˆå¤šnginxåå‘ä»£ç†çš„æ•™ç¨‹ï¼Œä½†æ˜¯çº¯javaå®ç°æ²¡æœ‰æ‰¾åˆ°ï¼Œæ„Ÿè§‰å¯ä»¥è¯•ä¸€è¯•ã€‚ ï¼ˆä¸€ï¼‰ é¦–å…ˆè¦è§£å†³åå‘ä»£ç†çš„é—®é¢˜ï¼Œæœåˆ°org.mitre.dsmiley.httpproxy.ProxyServletå¯è§£å†³ã€‚ \u003cdependency\u003e \u003cgroupId\u003eorg.mitre.dsmiley.httpproxy\u003c/groupId\u003e \u003cartifactId\u003esmiley-http-proxy-servlet\u003c/artifactId\u003e \u003cversion\u003e1.11\u003c/version\u003e \u003c/dependency\u003e @Configuration public class MyConfig { @Bean public ServletRegistrationBean servletRegistrationAliBean01() { ServletRegistrationBean oss = new ServletRegistrationBean(new ProxyServlet(), \"/ali/bucket_name/*\");//ä¿®æ”¹ä¸ºè‡ªå·±çš„bucket_name oss.setName(\"bucket_name\"); oss.addInitParameter(\"targetUri\", \"http://bucket_name.oss-cn-beijing.aliyuncs.com\");//æœ¬åœ°æµ‹è¯•ç¯å¢ƒç”¨å¤–ç½‘åœ°å€ï¼Œçº¿ä¸Šæ”¹æˆå†…ç½‘è®¿é—®çš„åœ°å€ oss.addInitParameter(ProxyServlet.P_LOG, \"true\"); return oss; } } ï¼ˆäºŒï¼‰ Controlleré…ç½®å¦‚ä¸‹ï¼Œè½¬å‘åˆ°è‡ªå·±é…ç½®çš„åå‘ä»£ç† @RestController @RefreshScope @RequestMapping(\"/api/es\") public class TestController { @RequestMapping(\"/static/**\") public void testVideoOne(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException, URISyntaxException { String resourcePath = request.getRequestURI().replace(\"/api/es/static\",\"\"); HeaderUtil.setHeaderOwn(request,resourcePath); request.getRequestDispatcher(\"/ali\" + resourcePath).forward(request, response); } } ï¼ˆä¸‰ï¼‰ å…¶ä¸­ä¸ºrequestè®¾ç½®Headerä»¥è®¤è¯OSSè®¿é—®çš„HeaderUtilå¦‚ä¸‹ï¼Œå…¶ä¸­æœ‰OSS Authorizationè®¡ç®—çš„javaå®ç°ï¼Œç”¨javaçš„åå°„åœ¨requestä¸­æ·»åŠ Headerä¿¡æ¯ã€‚ import org.apache.commons.codec.binary.Base64; import org.apache.tomcat.util.http.MimeHeaders; import javax.crypto.Mac; import javax.crypto.spec.SecretKeySpec; import javax.servlet.http.HttpServletRequest; import java.lang.reflect.Field; import java.net.URISyntaxException; import java.nio.charset.Charset; import java.security.InvalidKeyException; import java.security.NoSuchAlgorithmException; import java.text.SimpleDateFormat; import java.util.Date; import java.util.Locale; import java.util.TimeZone; public class HeaderUtil { /** * ç»™requeståŠ å…¥Headerä¿¡æ¯ï¼ŒéªŒè¯OSSè®¿é—®æƒé™ * @param request * @throws URISyntaxException */ public static void setHeaderOwn(HttpServletRequest request,String resourcePath) throws URISyntaxException { SimpleDateFormat sdf = new SimpleDateFormat(\"EEE, dd MMM yyyy HH:mm:ss 'GMT'\", Locale.US); sdf.setTimeZone(TimeZone.getTimeZone(\"GMT\")); String date_GMT = sdf.format(new Date()); String data = request.getMethod() + \"\\n\" + \"\\n\" + \"\\n\" + date_GMT + \"\\n\" + resourcePath; String signature = genHMAC(\"AccessKeySecret\", data);//AccessKeySecretæ”¹æˆè‡ªå·±çš„ reflectSetParam(request, \"Authorization\", \"OSS AccessKeyId:\" + signature);//AccessKeyIdæ”¹æˆè‡ªå·±çš„ reflectSetParam(request, \"Date\", date_GMT); } /** * åå°„ä¿®æ”¹headerä¿¡æ¯ï¼Œkey-valueé”®å€¼å¯¹åŠ å…¥åˆ°headerä¸­ * * @param request * @param key * @param value */ private static void reflectSetParam(HttpServletRequest request, String key, String value) { Class\u003c? extends HttpServletRequest\u003e requestClass = request.getClass(); // System.out.println(\"requestå®ç°ç±»=\"+requestClass.getName()); try { Field request1 = requestClass.getDeclaredField(\"request\"); request1.setAccessible(true); Object o = request1.get(request); Field coyoteRequest = o.getClass().getDeclaredField(\"coyoteRequest\"); coyoteRequest.setAccessible(true); Object o1 = coyoteRequest.get(o); // System.out.println(\"coyoteRequestå®ç°ç±»=\"+o1.getClass().getName()); Field headers = o1.getClass().getDeclaredField(\"headers\"); headers.setAccessible(true); MimeHeaders o2 = (MimeHeaders) headers.get(o1); o2.addValue(key).setString(value); } catch (Exception e) { e.printStackTrace(); } } /** * HmacSHA1 Base64åŠ å¯† * @param key * @param data * @return */ public static String genHMAC(String key, String data) { byte[] result = null; try { //æ ¹æ®ç»™å®šçš„å­—èŠ‚æ•°ç»„æ„é€ ä¸€ä¸ªå¯†é’¥,ç¬¬äºŒå‚æ•°æŒ‡å®šä¸€ä¸ªå¯†é’¥ç®—æ³•çš„åç§° SecretKeySpec signinKey = new SecretKeySpec(key.getBytes(), \"HmacSHA1\"); //ç”Ÿæˆä¸€ä¸ªæŒ‡å®š Mac ç®—æ³• çš„ Mac å¯¹è±¡ Mac mac = Mac.getInstance(\"HmacSHA1\"); //ç”¨ç»™å®šå¯†é’¥åˆå§‹åŒ– Mac å¯¹è±¡ mac.init(signinKey); //å®Œæˆ Mac æ“ä½œ byte[] rawHmac = mac.doFinal(data.getBytes(Charset.forName(\"UTF-8\"))); result = Base64.encodeBase64(rawHmac); } catch (NoSuchAlgorithmException e) { System.err.println(e.getMessage()); } catch (InvalidKeyException e) { System","date":"2023-04-17","objectID":"/posts/spring-proxy-oss/:0:0","tags":["java","oss"],"title":"spring cloud javaåå‘ä»£ç†è®¿é—®é˜¿é‡Œäº‘OSSç§æœ‰èµ„æº","uri":"/posts/spring-proxy-oss/"},{"categories":null,"content":"\u003cno value\u003e's friends","date":"2023-04-17","objectID":"/friends/","tags":null,"title":"å‹æƒ…é“¾æ¥","uri":"/friends/"},{"categories":null,"content":"åŸºæœ¬ä¿¡æ¯ - nickname: Lruihao avatar: https://lruihao.cn/images/avatar.jpg url: https://lruihao.cn description: Lruihao's Note ","date":"2023-04-17","objectID":"/friends/:1:0","tags":null,"title":"å‹æƒ…é“¾æ¥","uri":"/friends/"},{"categories":null,"content":"å‹æƒ…æé†’ Notice äº’æ¢å‹é“¾è¯·æŒ‰ä»¥ä¸Šæ ¼å¼åœ¨è¯„è®ºç•™è¨€ã€‚ï¼ˆä»…é™ä¸ªäººéå•†ä¸šåšå®¢ / ç½‘ç«™ï¼‰ æé†’ï¼šç½‘ç«™å¤±æ•ˆã€åœæ­¢ç»´æŠ¤ã€å†…å®¹ä¸å½“éƒ½å¯èƒ½è¢«å–æ¶ˆè¿æ¥ï¼ é‚£äº›ä¸å°Šé‡ä»–äººåŠ³åŠ¨æˆæœï¼Œè½¬è½½ä¸åŠ å‡ºå¤„çš„ï¼Œæˆ–æ¶æ„è¡Œä¸ºçš„ç½‘ç«™ï¼Œè¿˜è¯·æ‚¨ä¸è¦æ¥è¿›è¡Œäº¤æ¢äº†ã€‚ ","date":"2023-04-17","objectID":"/friends/:2:0","tags":null,"title":"å‹æƒ…é“¾æ¥","uri":"/friends/"},{"categories":null,"content":"ç¦»çº¿ - PME-Blog","date":"0001-01-01","objectID":"/offline/","tags":null,"title":"","uri":"/offline/"}]